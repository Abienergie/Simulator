var ht=Object.defineProperty;var pt=(t,s,a)=>s in t?ht(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a;var X=(t,s,a)=>pt(t,typeof s!="symbol"?s+"":s,a);import{r as m,b as gt,u as W,d as U,L as H,N as ft,H as bt,e as yt,f as T,R as jt}from"./vendor-CbVJkecO.js";import{E as vt,a as B}from"./pdf-ChTLBbIY.js";import{R as Ce,B as Pe,C as Ae,X as Ee,Y as Me,T as Ie,L as Re,a as Q}from"./charts-CJ_PvRof.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function a(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(o){if(o.ep)return;o.ep=!0;const r=a(o);fetch(o.href,r)}})();var Ve={exports:{}},ae={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Nt=m,wt=Symbol.for("react.element"),kt=Symbol.for("react.fragment"),St=Object.prototype.hasOwnProperty,Ct=Nt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Pt={key:!0,ref:!0,__self:!0,__source:!0};function We(t,s,a){var n,o={},r=null,l=null;a!==void 0&&(r=""+a),s.key!==void 0&&(r=""+s.key),s.ref!==void 0&&(l=s.ref);for(n in s)St.call(s,n)&&!Pt.hasOwnProperty(n)&&(o[n]=s[n]);if(t&&t.defaultProps)for(n in s=t.defaultProps,s)o[n]===void 0&&(o[n]=s[n]);return{$$typeof:wt,type:t,key:r,ref:l,props:o,_owner:Ct.current}}ae.Fragment=kt;ae.jsx=We;ae.jsxs=We;Ve.exports=ae;var e=Ve.exports,Ue,De=gt;Ue=De.createRoot,De.hydrateRoot;const Be=m.createContext(void 0),Ge="solar_client_data";function At(t){try{localStorage.setItem(Ge,JSON.stringify(t))}catch(s){console.error("Error saving client data:",s)}}function Et(){try{const t=localStorage.getItem(Ge);return t?JSON.parse(t):null}catch(t){return console.error("Error loading client data:",t),null}}function Mt(){try{localStorage.clear();const t=sessionStorage.getItem("auth_token");t&&localStorage.setItem("auth_token",t)}catch(t){console.error("Error clearing client data:",t)}}const Te={civilite:"",nom:"",prenom:"",telephone:"",email:""},oe={rue:"",codePostal:"",ville:"",pays:"France",region:"",coordinates:void 0};function It({children:t}){const[s,a]=m.useState(Te),[n,o]=m.useState(oe);m.useEffect(()=>{const c=Et();c&&(a(c.clientInfo),o(d=>({...oe,...c.address})))},[]),m.useEffect(()=>{At({clientInfo:s,address:n})},[s,n]);const r=c=>{a(d=>({...d,...c}))},l=c=>{o(d=>({...d,...c}))},i=()=>{a({...Te}),o({...oe}),Mt()};return e.jsx(Be.Provider,{value:{clientInfo:s,address:n,updateClientInfo:r,updateAddress:l,resetClientInfo:i},children:t})}function _(){const t=m.useContext(Be);if(t===void 0)throw new Error("useClient must be used within a ClientProvider");return t}const ce=[{power:2.5,price:6890},{power:3,price:7890},{power:3.5,price:8890},{power:4,price:9890},{power:4.5,price:10890},{power:5,price:11890},{power:5.5,price:12890},{power:6,price:14890},{power:6.5,price:15890},{power:7,price:16890},{power:7.5,price:17890},{power:8,price:18890},{power:8.5,price:19890},{power:9,price:19890}],I={baseKwhPrice:.25,baseSellPrice:.1269,sellPriceDate:"2025-01-01",defaultAutoconsumption:75,defaultEnergyRevaluation:7,defaultSellIndexation:2,defaultPanelDegradation:-.2,installationPrices:ce,defaultSubsidyUnder3kw:220,defaultSubsidyOver3kw:160,defaultSubsidy9to36kw:110,defaultSubsidy36to100kw:80,subsidyDate:"2025-01-01"},Ke=m.createContext(void 0);function Rt({children:t}){const[s,a]=m.useState(()=>{try{const l={...I,baseKwhPrice:parseFloat(localStorage.getItem("base_kwh_price")||I.baseKwhPrice.toString()),baseSellPrice:parseFloat(localStorage.getItem("base_sell_price")||I.baseSellPrice.toString()),sellPriceDate:localStorage.getItem("sell_price_date")||I.sellPriceDate,defaultAutoconsumption:parseFloat(localStorage.getItem("default_autoconsumption")||I.defaultAutoconsumption.toString()),defaultEnergyRevaluation:parseFloat(localStorage.getItem("default_energy_revaluation")||I.defaultEnergyRevaluation.toString()),defaultSellIndexation:parseFloat(localStorage.getItem("default_sell_indexation")||I.defaultSellIndexation.toString()),defaultPanelDegradation:parseFloat(localStorage.getItem("default_panel_degradation")||I.defaultPanelDegradation.toString()),defaultSubsidyUnder3kw:parseFloat(localStorage.getItem("default_subsidy_under_3kw")||I.defaultSubsidyUnder3kw.toString()),defaultSubsidyOver3kw:parseFloat(localStorage.getItem("default_subsidy_over_3kw")||I.defaultSubsidyOver3kw.toString()),defaultSubsidy9to36kw:parseFloat(localStorage.getItem("default_subsidy_9to36kw")||I.defaultSubsidy9to36kw.toString()),defaultSubsidy36to100kw:parseFloat(localStorage.getItem("default_subsidy_36to100kw")||I.defaultSubsidy36to100kw.toString()),subsidyDate:localStorage.getItem("subsidy_date")||I.subsidyDate,installationPrices:[...ce]},i=localStorage.getItem("installation_prices");if(i)try{const c=JSON.parse(i);if(Array.isArray(c)){const d=c.filter(u=>u&&typeof u.power=="number"&&typeof u.price=="number"&&u.power>9);l.installationPrices=[...ce,...d].sort((u,g)=>u.power-g.power)}}catch(c){console.error("Erreur lors du parsing des prix personnalisés:",c)}return l}catch(l){return console.error("Erreur lors du chargement des paramètres:",l),I}}),n=l=>{a(i=>{const c={...i,...l};return Object.entries(l).forEach(([d,u])=>{if(d==="installationPrices"){const g=u.filter(x=>x.power>9);localStorage.setItem("installation_prices",JSON.stringify(g))}else localStorage.setItem(d.replace(/([A-Z])/g,"_$1").toLowerCase(),typeof u=="object"?JSON.stringify(u):u.toString())}),c})},o=(l,i)=>{if(l<=0||i<=0){console.error("Puissance et prix doivent être positifs");return}a(c=>{const d=c.installationPrices.findIndex(x=>Math.abs(x.power-l)<.01);let u;d>=0?(u=[...c.installationPrices],u[d]={power:l,price:i}):u=[...c.installationPrices,{power:l,price:i}],u.sort((x,p)=>x.power-p.power);const g=u.filter(x=>x.power>9);return localStorage.setItem("installation_prices",JSON.stringify(g)),{...c,installationPrices:u}})},r=l=>{if(l<=9){console.error("Impossible de supprimer les prix par défaut");return}a(i=>{const c=i.installationPrices.filter(u=>Math.abs(u.power-l)>=.01),d=c.filter(u=>u.power>9);return localStorage.setItem("installation_prices",JSON.stringify(d)),{...i,installationPrices:c}})};return e.jsx(Ke.Provider,{value:{settings:s,updateSettings:n,addInstallationPrice:o,removeInstallationPrice:r},children:t})}function re(){const t=m.useContext(Ke);if(t===void 0)throw new Error("useFinancialSettings must be used within a FinancialSettingsProvider");return t}/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Dt={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tt=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),v=(t,s)=>{const a=m.forwardRef(({color:n="currentColor",size:o=24,strokeWidth:r=2,absoluteStrokeWidth:l,className:i="",children:c,...d},u)=>m.createElement("svg",{ref:u,...Dt,width:o,height:o,stroke:n,strokeWidth:l?Number(r)*24/Number(o):r,className:["lucide",`lucide-${Tt(t)}`,i].join(" "),...d},[...s.map(([g,x])=>m.createElement(g,x)),...Array.isArray(c)?c:[c]]));return a.displayName=`${t}`,a};/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=v("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=v("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=v("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=v("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=v("Battery",[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=v("Briefcase",[["rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2",key:"eto64e"}],["path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"zwj3tp"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ft=v("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=v("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=v("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ot=v("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=v("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=v("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zt=v("CheckSquare",[["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}],["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11",key:"1jnkn4"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=v("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qt=v("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=v("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ht=v("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=v("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vt=v("Coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wt=v("Cpu",[["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"9",y:"9",width:"6",height:"6",key:"o3kz5p"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=v("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ut=v("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bt=v("DoorOpen",[["path",{d:"M13 4h3a2 2 0 0 1 2 2v14",key:"hrm0s9"}],["path",{d:"M2 20h3",key:"1gaodv"}],["path",{d:"M13 20h9",key:"s90cdi"}],["path",{d:"M10 12v.01",key:"vx6srw"}],["path",{d:"M13 4.562v16.157a1 1 0 0 1-1.242.97L5 20V5.562a2 2 0 0 1 1.515-1.94l4-1A2 2 0 0 1 13 4.561Z",key:"199qr4"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=v("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kt=v("Euro",[["path",{d:"M4 10h12",key:"1y6xl8"}],["path",{d:"M4 14h9",key:"1loblj"}],["path",{d:"M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 5.2-2",key:"1j6lzo"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=v("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=v("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=v("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xt=v("FileDown",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=v("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=v("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=v("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=v("HeartHandshake",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}],["path",{d:"M12 5 9.04 7.96a2.17 2.17 0 0 0 0 3.08v0c.82.82 2.13.85 3 .07l2.07-1.9a2.82 2.82 0 0 1 3.79 0l2.96 2.66",key:"12sd6o"}],["path",{d:"m18 15-2-2",key:"60u0ii"}],["path",{d:"m15 18-2-2",key:"6p76be"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=v("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=v("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=v("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=v("Leaf",[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=v("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=v("LineChart",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=v("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=v("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=v("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=v("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=v("PiggyBank",[["path",{d:"M19 5c-1.5 0-2.8 1.4-3 2-3.5-1.5-11-.3-11 5 0 1.8 0 3 2 4.5V20h4v-2h3v2h4v-4c1-.5 1.7-1 2-2h2v-4h-2c0-1-.5-1.5-1-2h0V5z",key:"uf6l00"}],["path",{d:"M2 9v1c0 1.1.9 2 2 2h1",key:"nm575m"}],["path",{d:"M16 11h0",key:"k2aug8"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=v("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=v("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=v("Ruler",[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=v("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=v("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=v("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=v("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=v("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=v("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=v("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=v("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=v("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=v("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=v("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=v("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=v("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]);function z(t="smooth"){window.scrollTo({top:0,behavior:t})}function gs(){const t=W(),s=U(),{clientInfo:a}=_(),n=!!(a.civilite&&a.nom&&a.prenom&&a.telephone&&a.email),o=[{path:"/",label:"Dimensionnement",icon:Ht,description:"Caractéristiques de votre installation"},{path:"/projection",label:"Projection financière",icon:be,description:"Simulation de rentabilité"},{path:"/eligibilite",label:"Tester mon éligibilité",icon:zt,description:"Vérification des conditions"},{path:"/rapport",label:"Rapport",icon:Qt,description:"Rapport détaillé"},{path:"/modalites-abonnement",label:"Modalités d'abonnement",icon:$,description:"Conditions et engagements",isStatic:!0},{path:"/modalites-sortie",label:"Modalités de sortie",icon:Bt,description:"Conditions de résiliation",isStatic:!0}],r=(l,i)=>{if(i||l==="/abie-link"||l==="/settings"||l==="/agence"){s(l),z();return}if(!n&&l!=="/"){alert("Veuillez remplir tous les champs obligatoires avant de continuer.");return}s(l),z()};return e.jsx("nav",{className:"w-64 bg-white border-r border-gray-200 h-full py-6",children:e.jsxs("div",{className:"px-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Menu"}),e.jsx("div",{className:"space-y-1",children:o.map((l,i)=>{const c=l.icon,d=t.pathname===l.path,u=!l.isStatic&&!n&&l.path!=="/";return e.jsxs("button",{onClick:()=>r(l.path,l.isStatic),disabled:u,className:`w-full group flex items-start gap-4 p-3 rounded-lg transition-colors ${d?"bg-blue-50 text-blue-600":u?"text-gray-400 cursor-not-allowed":"text-gray-600 hover:bg-gray-50"}`,children:[e.jsx("div",{className:`flex-shrink-0 flex items-center justify-center w-8 h-8 rounded-full bg-white border text-sm font-medium ${d?"border-blue-200":"border-gray-200"}`,children:i+1}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{className:`h-5 w-5 ${d?"text-blue-500":u?"text-gray-300":"text-gray-400"}`}),e.jsx("span",{className:"text-sm font-medium",children:l.label})]}),e.jsx("p",{className:`mt-1 text-xs ${u?"text-gray-400":"text-gray-500"}`,children:l.description})]})]},l.path)})}),e.jsxs("div",{className:"mt-8 pt-6 border-t border-gray-200 space-y-2",children:[e.jsxs("button",{onClick:()=>r("/abie-link"),className:`w-full group flex items-center gap-3 p-3 rounded-lg transition-colors ${t.pathname==="/abie-link"?"bg-green-50 text-green-600":"text-gray-600 hover:bg-gray-50"}`,children:[e.jsx(je,{className:`h-5 w-5 ${t.pathname==="/abie-link"?"text-green-500":"text-gray-400"}`}),e.jsx("span",{className:"text-sm font-medium",children:"Abie Link"})]}),e.jsxs("button",{onClick:()=>r("/agence"),className:`w-full group flex items-center gap-3 p-3 rounded-lg transition-colors ${t.pathname==="/agence"?"bg-purple-50 text-purple-600":"text-gray-600 hover:bg-gray-50"}`,children:[e.jsx(Ye,{className:`h-5 w-5 ${t.pathname==="/agence"?"text-purple-500":"text-gray-400"}`}),e.jsx("span",{className:"text-sm font-medium",children:"Info agence"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsxs("button",{onClick:()=>r("/settings"),className:`w-full group flex items-center gap-3 p-3 rounded-lg transition-colors ${t.pathname==="/settings"?"bg-gray-100 text-gray-900":"text-gray-600 hover:bg-gray-50"}`,children:[e.jsx(cs,{className:`h-5 w-5 ${t.pathname==="/settings"?"text-gray-900":"text-gray-400"}`}),e.jsx("span",{className:"text-sm font-medium",children:"Réglages"})]})})]})})}function fs({children:t}){const[s,a]=m.useState(window.innerWidth>=1024);return m.useEffect(()=>{const n=()=>{window.innerWidth>=1024?a(!0):a(!1)};return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),e.jsxs("div",{className:"min-h-screen",children:[e.jsxs("div",{className:"fixed inset-y-0 left-0 z-30",children:[e.jsx("div",{className:`fixed inset-y-0 w-64 bg-white border-r border-gray-200 transition-transform duration-300 ease-in-out ${s?"translate-x-0":"-translate-x-full"}`,children:e.jsx("div",{className:"h-full overflow-y-auto",children:e.jsx(gs,{})})}),e.jsx("button",{onClick:()=>a(!s),className:`fixed top-4 bg-white rounded-full p-1 shadow-md border border-gray-200 transition-transform duration-300 ease-in-out lg:hidden ${s?"left-[246px]":"left-0"}`,"aria-label":s?"Réduire le menu":"Ouvrir le menu",children:s?e.jsx(qt,{className:"h-4 w-4 text-gray-600"}):e.jsx(G,{className:"h-4 w-4 text-gray-600"})})]}),s&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 transition-opacity lg:hidden z-20",onClick:()=>a(!1)}),e.jsx("div",{className:`${s?"lg:pl-64":""}`,children:t})]})}function Fe(){return e.jsx("div",{className:"h-32",children:e.jsx("img",{src:"https://i.postimg.cc/7Z49VZpw/ABI-e-nergie-Blanc.png",alt:"ABI Énergie",className:"h-full w-auto"})})}function bs(){const t=W();return["/modalites-abonnement","/modalites-sortie"].includes(t.pathname)?e.jsx("header",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"max-w-6xl mx-auto px-4 py-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Fe,{})}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(J,{className:"h-6 w-6 sm:h-8 sm:w-8 text-amber-400"}),e.jsx("h1",{className:"text-xl sm:text-2xl font-semibold text-gray-900",children:"Simulateur Solaire"})]})]})})}):e.jsxs("header",{className:"relative w-full bg-gradient-to-b from-blue-900 to-blue-700",children:[e.jsx("div",{className:"absolute inset-0",children:e.jsx("img",{src:"https://images.unsplash.com/photo-1508514177221-188b1cf16e9d?auto=format&fit=crop&q=80",alt:"Solar panels under blue sky with sun",className:"w-full h-80 object-cover brightness-50"})}),e.jsx("div",{className:"relative z-10 h-80",children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"max-w-6xl mx-auto px-4 py-6 sm:px-6 lg:px-8 lg:pl-72",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Fe,{})}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(J,{className:"h-6 w-6 sm:h-8 sm:w-8 text-amber-400"}),e.jsx("h1",{className:"text-xl sm:text-2xl font-semibold text-white",children:"Simulateur Solaire"})]})]})})}),e.jsx("div",{className:"flex-1 flex items-center",children:e.jsx("div",{className:"w-full",children:e.jsx("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 lg:pl-72",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-white mb-3",children:"Optimisez votre transition énergétique"}),e.jsx("p",{className:"text-base sm:text-lg text-gray-200 max-w-2xl mx-auto",children:"Calculez votre potentiel solaire et découvrez les économies possibles avec une installation photovoltaïque adaptée à vos besoins"})]})})})})]})})]})}const ys={"01":1320,"02":1140,"03":1290,"04":1540,"05":1540,"06":1590,"07":1450,"08":1070,"09":1350,10:1210,11:1580,12:1410,13:1580,14:1170,15:1290,16:1340,17:1450,18:1250,19:1320,21:1240,22:1200,23:1280,24:1360,25:1240,26:1470,27:1220,28:1220,29:1200,30:1580,31:1430,32:1400,33:1400,34:1580,35:1220,36:1280,37:1280,38:1390,39:1270,40:1380,41:1250,42:1380,43:1330,44:1290,45:1220,46:1390,47:1420,48:1380,49:1290,50:1150,51:1170,52:1170,53:1220,54:1170,55:1170,56:1290,57:1220,58:1270,59:1050,60:1180,61:1180,62:1120,63:1300,64:1340,65:1350,66:1580,67:1190,68:1190,69:1340,70:1190,71:1290,72:1220,73:1380,74:1310,75:1140,76:1140,77:1140,78:1180,79:1330,80:1120,81:1410,82:1420,83:1560,84:1630,85:1340,86:1310,87:1320,88:1220,89:1210,90:1190,91:1210,92:1180,93:1180,94:1180,95:1180,971:2e3,972:2e3,973:1800,974:2200,976:1800,"2B":1580};function ke(t){const s=ys[t];return s||(console.warn(`Pas de données d'ensoleillement pour le département ${t}, utilisation de la moyenne nationale`),1300)}const le={[-90]:{0:1,10:.99,15:.99,20:.97,25:.97,30:.94,35:.94,40:.9,45:.9,50:.84,55:.84,60:.81,90:.58},90:{0:1,10:.99,15:.99,20:.97,25:.97,30:.94,35:.94,40:.9,45:.9,50:.84,55:.84,60:.81,90:.58},0:{0:1,10:1.1,15:1.1,20:1.14,25:1.14,30:1.15,35:1.15,40:1.14,45:1.14,50:1.1,55:1.1,60:1.08,90:.79},[-45]:{0:1,10:1.07,15:1.07,20:1.09,25:1.09,30:1.09,35:1.09,40:1.07,45:1.07,50:1.03,55:1.03,60:1,90:.74},45:{0:1,10:1.07,15:1.07,20:1.09,25:1.09,30:1.09,35:1.09,40:1.07,45:1.07,50:1.03,55:1.03,60:1,90:.74}};function st(t,s){const a=Math.max(-90,Math.min(90,t)),o=Object.keys(le).map(Number).reduce((c,d)=>Math.abs(d-a)<Math.abs(c-a)?d:c),r=Math.max(0,Math.min(90,s)),i=Object.keys(le[o]).map(Number).reduce((c,d)=>Math.abs(d-r)<Math.abs(c-r)?d:c);return le[o][i]}function js(t,s,a,n,o,r=0){const l=ke(o),i=st(n,a);let c=l*i*t;return c=c*(1-s/100),c=c*(1-r/100),Math.round(c)}async function vs(t){if(!t.adresse.codePostal)throw new Error("Code postal manquant");if(!t.typeCompteur)throw new Error("Type de compteur manquant");const s=t.nombreModules*t.puissanceModules/1e3,a=t.nombreModules*t.surfaceUnitaire;try{const n=t.adresse.codePostal.substring(0,2);return{productionAnnuelle:js(s,t.pertes,t.inclinaison,t.orientation,n,t.masqueSolaire),puissanceCrete:Math.round(s*100)/100,surfaceTotale:Math.round(a*100)/100,typeCompteur:t.typeCompteur}}catch(n){throw console.error("Erreur lors du calcul:",n),new Error("Erreur lors du calcul de la production")}}const Le={monophase:6,triphase:9};function nt(t){return t==="monophase"?Le.monophase:Le.triphase}const Ns={LOAD_SHIFTING:1.05,PEAK_HOURS:{SUMMER:{start:11,end:16},WINTER:{start:12,end:15}},SHIFTABLE_LOADS:{WASHING_MACHINE:{power:2e3,duration:2},DISHWASHER:{power:1500,duration:1.5},DRYER:{power:2500,duration:1},WATER_HEATER:{power:2e3,duration:2},POOL_PUMP:{power:800,duration:6}}};function ws(t,s){if(!s||!t)return 0;const a=t/s;let n;return a<=.35?n=.95:a<=.45?n=.9:a<=.6?n=.85:n=.75,n*=Ns.LOAD_SHIFTING,Math.round(n*100)}function ks(t){return t>=90?"Optimisation maximale : excellente rentabilité grâce au déplacement intelligent des consommations":t>=85?"Très forte rentabilité grâce à une autoconsommation optimisée aux heures solaires":t>=75?"Excellent retour sur investissement avec une consommation adaptée à la production":"Forte rentabilité grâce à une bonne gestion de la consommation"}const Ss=.25,Cs=.1269;function Ps(t,s){const a=t*s/100,n=t-a,o=a*Ss,r=n*Cs;return{economiesAnnuelles:Math.round(o),reventeAnnuelle:Math.round(r)}}function As(t){const{consommationAnnuelle:s,codePostal:a,typeCompteur:n}=t;if(!s||!a||s<=0)return null;const o=a.substring(0,2),r=ke(o),l=6/1e4;let i=s*l;i=Math.max(i,3);const c=nt(n),d=Math.min(i,c),u=Math.ceil(d*1e3/500),g=u*500/1e3,x=Math.round(g*r),p=ws(x,s),{economiesAnnuelles:y,reventeAnnuelle:k}=Ps(x,p);let j=null;return i>c&&(j=`Une installation plus puissante de ${i.toFixed(1)} kWc maximiserait vos économies. Contactez-nous pour étudier la possibilité de passer en triphasé ou d'installer plusieurs onduleurs.`),{nombreModules:u,puissanceCrete:g,production:x,tauxAutoconsommation:p,economiesAnnuelles:y,reventeAnnuelle:k,avertissement:j}}function te({label:t,name:s,value:a,onChange:n,placeholder:o,disabled:r}){return e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:t}),e.jsx("input",{type:"text",name:s,value:a,onChange:n,placeholder:o,disabled:r,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 disabled:bg-gray-100",required:!r})]})}async function Es(t){if(!t||t.length<3)return[];try{const s=t.trim(),a=new AbortController,n=setTimeout(()=>a.abort(),1e4),o=await fetch(`https://api-adresse.data.gouv.fr/search/?q=${encodeURIComponent(s)}&limit=5&autocomplete=1`,{signal:a.signal,headers:{Accept:"application/json","User-Agent":"Simulateur Solaire/1.0"}});if(clearTimeout(n),!o.ok)throw new Error(`Erreur HTTP: ${o.status}`);const r=await o.json();if(!Array.isArray(r.features))throw new Error("Format de réponse invalide");return r.features.filter(l=>l.properties.type==="housenumber"||l.properties.type==="street")}catch(s){if(s instanceof Error){if(s.name==="AbortError")return console.error("Timeout de la requête API adresse"),[];console.error("Erreur API adresse:",s.message)}else console.error("Erreur API adresse inconnue");return[]}}function Ms({value:t,onChange:s,onSelect:a}){const[n,o]=m.useState([]),[r,l]=m.useState(!1),[i,c]=m.useState(!1),[d,u]=m.useState(null),[g,x]=m.useState(!1),p=m.useRef(null),y=m.useRef();m.useEffect(()=>{const N=async()=>{if(!t||t.length<3||g){o([]),u(null);return}c(!0),u(null);try{const w=await Es(t);o(w),l(!0)}catch{u("Impossible de récupérer les suggestions. Veuillez réessayer."),o([])}finally{c(!1)}};return y.current&&clearTimeout(y.current),y.current=setTimeout(N,300),()=>{y.current&&clearTimeout(y.current)}},[t,g]),m.useEffect(()=>{const N=w=>{p.current&&!p.current.contains(w.target)&&l(!1)};return document.addEventListener("mousedown",N),()=>document.removeEventListener("mousedown",N)},[]);const k=N=>{x(!1),u(null);const w=N.target.value||"";s(w)},j=N=>{const{properties:w,geometry:b}=N,f={lat:b.coordinates[1],lon:b.coordinates[0]},C=w.housenumber?`${w.housenumber} ${w.street}`:w.street;x(!0),s(C),a(C,w.postcode,w.city,f),l(!1),o([])};return e.jsxs("div",{ref:p,className:"relative",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:t||"",onChange:k,onFocus:()=>!g&&l(!0),placeholder:"Entrez votre adresse...",className:`w-full pl-10 pr-4 py-2 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 ${d?"border-red-300":"border-gray-300"}`}),e.jsx(tt,{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400"}),i&&e.jsx("div",{className:"absolute right-3 top-2.5",children:e.jsx("div",{className:"animate-spin h-5 w-5 border-2 border-blue-500 rounded-full border-t-transparent"})})]}),d&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d}),r&&n.length>0&&e.jsx("ul",{className:"absolute z-10 w-full mt-1 bg-white shadow-lg max-h-60 rounded-md py-1 text-base overflow-auto focus:outline-none sm:text-sm",children:n.map(N=>e.jsx("li",{onClick:()=>j(N),className:"cursor-pointer select-none relative py-2 pl-3 pr-9 hover:bg-blue-50",children:e.jsx("div",{className:"flex items-center",children:e.jsx("span",{className:"font-normal block truncate",children:N.properties.label})})},N.properties.id))})]})}const Is={"01":"Auvergne-Rhône-Alpes","03":"Auvergne-Rhône-Alpes","07":"Auvergne-Rhône-Alpes",15:"Auvergne-Rhône-Alpes",26:"Auvergne-Rhône-Alpes",38:"Auvergne-Rhône-Alpes",42:"Auvergne-Rhône-Alpes",43:"Auvergne-Rhône-Alpes",63:"Auvergne-Rhône-Alpes",69:"Auvergne-Rhône-Alpes",73:"Auvergne-Rhône-Alpes",74:"Auvergne-Rhône-Alpes",21:"Bourgogne-Franche-Comté",25:"Bourgogne-Franche-Comté",39:"Bourgogne-Franche-Comté",58:"Bourgogne-Franche-Comté",70:"Bourgogne-Franche-Comté",71:"Bourgogne-Franche-Comté",89:"Bourgogne-Franche-Comté",90:"Bourgogne-Franche-Comté",22:"Bretagne",29:"Bretagne",35:"Bretagne",56:"Bretagne",18:"Centre-Val de Loire",28:"Centre-Val de Loire",36:"Centre-Val de Loire",37:"Centre-Val de Loire",41:"Centre-Val de Loire",45:"Centre-Val de Loire","2A":"Corse","2B":"Corse","08":"Grand Est",10:"Grand Est",51:"Grand Est",52:"Grand Est",54:"Grand Est",55:"Grand Est",57:"Grand Est",67:"Grand Est",68:"Grand Est",88:"Grand Est","02":"Hauts-de-France",59:"Hauts-de-France",60:"Hauts-de-France",62:"Hauts-de-France",80:"Hauts-de-France",75:"Île-de-France",77:"Île-de-France",78:"Île-de-France",91:"Île-de-France",92:"Île-de-France",93:"Île-de-France",94:"Île-de-France",95:"Île-de-France",14:"Normandie",27:"Normandie",50:"Normandie",61:"Normandie",76:"Normandie",16:"Nouvelle-Aquitaine",17:"Nouvelle-Aquitaine",19:"Nouvelle-Aquitaine",23:"Nouvelle-Aquitaine",24:"Nouvelle-Aquitaine",33:"Nouvelle-Aquitaine",40:"Nouvelle-Aquitaine",47:"Nouvelle-Aquitaine",64:"Nouvelle-Aquitaine",79:"Nouvelle-Aquitaine",86:"Nouvelle-Aquitaine",87:"Nouvelle-Aquitaine","09":"Occitanie",11:"Occitanie",12:"Occitanie",30:"Occitanie",31:"Occitanie",32:"Occitanie",34:"Occitanie",46:"Occitanie",48:"Occitanie",65:"Occitanie",66:"Occitanie",81:"Occitanie",82:"Occitanie",44:"Pays de la Loire",49:"Pays de la Loire",53:"Pays de la Loire",72:"Pays de la Loire",85:"Pays de la Loire","04":"Provence-Alpes-Côte d'Azur","05":"Provence-Alpes-Côte d'Azur","06":"Provence-Alpes-Côte d'Azur",13:"Provence-Alpes-Côte d'Azur",83:"Provence-Alpes-Côte d'Azur",84:"Provence-Alpes-Côte d'Azur"};function Oe(t){const s=t.substring(0,2);return Is[s]||""}function Rs({address:t,onChange:s}){m.useEffect(()=>{if(t.codePostal&&!t.region){const n=Oe(t.codePostal);n&&s("region",n)}},[t.codePostal,t.region,s]);const a=(n,o,r,l)=>{s("rue",""),s("codePostal",""),s("ville",""),s("region",""),s("rue",n||""),s("codePostal",o||""),s("ville",r||""),s("coordinates",l);const i=Oe(o);i&&s("region",i)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Rechercher votre adresse"}),e.jsx(Ms,{value:t.rue||"",onChange:n=>s("rue",n),onSelect:a})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(te,{label:"Code postal",name:"codePostal",value:t.codePostal||"",onChange:n=>s("codePostal",n.target.value),placeholder:"75001",disabled:!0}),e.jsx(te,{label:"Ville",name:"ville",value:t.ville||"",onChange:n=>s("ville",n.target.value),placeholder:"Paris",disabled:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(te,{label:"Région",name:"region",value:t.region||"",onChange:n=>s("region",n.target.value),disabled:!0}),e.jsx(te,{label:"Pays",name:"pays",value:t.pays||"France",onChange:n=>s("pays",n.target.value),disabled:!0})]})]})}const $e={nombreModules:6,surfaceUnitaire:2.3,inclinaison:30,orientation:0,puissanceModules:500,pertes:14,masqueSolaire:0,typeCompteur:"monophase",consommationAnnuelle:1e4,microOnduleurs:!1,bifacial:!1,adresse:{rue:"",codePostal:"",ville:"",pays:"France"}},Ds=[{value:"monophase",label:"Monophasé (limité à 6 kWc)"},{value:"triphase",label:"Triphasé"}];function K({label:t,name:s,value:a,onChange:n,options:o,unit:r}){return e.jsxs("div",{children:[e.jsxs("label",{htmlFor:s,className:"block text-sm font-medium text-gray-700 mb-1",children:[t," ",r&&e.jsxs("span",{className:"text-gray-500",children:["(",r,")"]})]}),e.jsx("select",{id:s,name:s,value:a,onChange:n,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:o.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]})}function O({label:t,name:s,value:a,onChange:n,min:o,max:r,step:l=1,unit:i,disabled:c=!1}){const d=Number.isFinite(a)?a:"";return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[t," ",i&&e.jsxs("span",{className:"text-gray-500",children:["(",i,")"]})]}),e.jsx("input",{type:"number",name:s,value:d,onChange:n,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 disabled:bg-gray-100",min:o,max:r,step:l,disabled:c,required:!c})]})}function Ts({value:t,onChange:s,label:a="Consommation annuelle estimée"}){const n=()=>{z()};return e.jsxs("div",{className:"space-y-4",children:[e.jsx(O,{label:a,name:"consommationAnnuelle",value:t,onChange:s,min:0,max:1e5,step:100,unit:"kWh/an"}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Vous trouverez votre consommation annuelle sur votre facture d'électricité."}),e.jsxs(H,{to:"/abie-link",onClick:n,className:"relative block bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl border border-blue-200 hover:border-blue-300 transition-colors group overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0",children:e.jsx("div",{className:"bg-amber-500 text-white text-xs px-3 py-1 rounded-bl-xl font-medium transform rotate-0",children:"Bientôt disponible"})}),e.jsxs("div",{className:"p-4 flex items-center gap-3",children:[e.jsx("div",{className:"flex-shrink-0 p-2.5 bg-blue-100 rounded-lg group-hover:bg-blue-200 transition-colors",children:e.jsx(we,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{className:"flex-grow",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-blue-600",children:"Connecter mon compteur Linky"}),e.jsx("span",{className:"text-xs px-2 py-0.5 bg-white/80 text-blue-600 rounded-full border border-blue-200",children:"Optionnel"})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-0.5",children:"Récupérez automatiquement vos données de consommation"})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"p-2 rounded-full group-hover:bg-blue-200/50 transition-colors",children:e.jsx(je,{className:"h-5 w-5 text-blue-400 group-hover:text-blue-600 transition-colors"})})})]})]})]})]})}function _s({typeCompteur:t,consommationAnnuelle:s,onTypeCompteurChange:a,onConsommationChange:n}){return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Dimensionnement"}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(K,{label:"Type de compteur",name:"typeCompteur",value:t,onChange:a,options:Ds}),e.jsx(Ts,{value:s,onChange:n})]})]})}function A(t){return new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR",minimumFractionDigits:2,maximumFractionDigits:2,useGrouping:!1}).format(t)}function Fs({recommendation:t,consommationAnnuelle:s,departement:a}){if(!t||!s)return null;const n=Math.round(t.production/s*100),o=t.economiesAnnuelles+t.reventeAnnuelle;return e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-green-50 p-6 rounded-lg shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(ns,{className:"h-7 w-7 text-blue-500"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Solution photovoltaïque recommandée"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white p-5 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(J,{className:"h-5 w-5 text-amber-500"}),e.jsx("h4",{className:"font-medium text-gray-900",children:"Votre installation"})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[t.puissanceCrete.toFixed(2)," kWc"]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:[t.nombreModules," panneaux haute performance de 500W"]})]}),e.jsxs("div",{className:"bg-white p-5 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(es,{className:"h-5 w-5 text-green-500"}),e.jsx("h4",{className:"font-medium text-gray-900",children:"Production solaire"})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[t.production.toLocaleString()," kWh/an"]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:[n,"% de votre consommation actuelle"]})]}),e.jsxs("div",{className:"bg-white p-5 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(_t,{className:"h-5 w-5 text-blue-500"}),e.jsx("h4",{className:"font-medium text-gray-900",children:"Autonomie énergétique"})]}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[t.tauxAutoconsommation,"%"]}),e.jsx("p",{className:"text-gray-600",children:"d'autoconsommation"})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:ks(t.tauxAutoconsommation)})]}),e.jsxs("div",{className:"bg-white p-5 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(et,{className:"h-5 w-5 text-emerald-500"}),e.jsx("h4",{className:"font-medium text-gray-900",children:"Économies 1ère année"})]}),e.jsxs("p",{className:"text-2xl font-bold text-emerald-600",children:[A(o),"/an"]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-2 space-y-1",children:[e.jsxs("p",{children:["• Économies : ",A(t.economiesAnnuelles),"/an"]}),e.jsxs("p",{children:["• Revente : ",A(t.reventeAnnuelle),"/an"]})]})]})]}),t.avertissement?e.jsxs("div",{className:"mt-6 p-4 bg-amber-50 border border-amber-200 rounded-lg flex items-start gap-3",children:[e.jsx(Je,{className:"h-5 w-5 text-amber-500 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-amber-800",children:t.avertissement})]}):e.jsx("div",{className:"mt-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-green-800",children:"Cette installation est parfaitement dimensionnée pour maximiser vos économies tout en optimisant votre investissement. Vous bénéficierez d'excellentes performances et d'un retour sur investissement optimal."})})]})}function Y({content:t}){const[s,a]=m.useState(!1);return e.jsxs("div",{className:"relative inline-block",children:[e.jsx(V,{className:"h-4 w-4 text-gray-400 hover:text-gray-600 cursor-help inline-block ml-1",onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1)}),s&&e.jsxs("div",{className:"absolute z-10 w-72 px-4 py-3 text-sm bg-gray-900 text-white rounded-lg shadow-lg left-1/2 -translate-x-1/2 top-6",children:[e.jsx("div",{className:"absolute -top-1 left-1/2 -translate-x-1/2 w-2 h-2 bg-gray-900 rotate-45"}),t]})]})}function ue({label:t,unit:s,tooltipContent:a,...n}){return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[t," ",s&&e.jsxs("span",{className:"text-gray-500",children:["(",s,")"]})]}),e.jsx(Y,{content:a})]}),e.jsx(O,{label:"",...n,className:"mt-0"})]})}function Ls({value:t,onChange:s,typeCompteur:a}){const{settings:n}=re(),o=n.installationPrices.map(d=>d.power).sort((d,u)=>d-u),r=nt(a),l=o.filter(d=>d<=r),i=o.filter(d=>d>9),c=[...l,...i].map(d=>({value:d,label:`${d.toFixed(1)} kWc${d>9?" (Pro)":""}`}));return e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{label:"Puissance de l'installation",name:"puissanceCrete",value:t,onChange:d=>s(parseFloat(d.target.value)),options:c,unit:"kWc"}),a==="monophase"&&t<=9&&e.jsx("p",{className:"text-sm text-gray-500",children:"Limité à 6 kWc en monophasé"}),t>9&&e.jsx("p",{className:"text-sm text-amber-500",children:"Installation professionnelle - Paiement comptant uniquement"})]})}const at=[{value:-90,label:"EST"},{value:-45,label:"SUD-EST"},{value:0,label:"SUD"},{value:45,label:"SUD-OUEST"},{value:90,label:"OUEST"}],Os=Array.from({length:19},(t,s)=>({value:s*5,label:`${s*5}°`}));function rt(t){const s=at.find(a=>a.value===t);return s?s.label:`${t}°`}const $s=[{value:0,label:"Aucun ombrage (0% de pertes)"},{value:5,label:"Ombrage léger - arbres éloignés (5% de pertes)"},{value:10,label:"Ombrage modéré - quelques arbres proches (10% de pertes)"},{value:15,label:"Ombrage important - bâtiments voisins (15% de pertes)"},{value:20,label:"Ombrage très important - environnement dense (20% de pertes)"}];function zs({orientation:t,inclinaison:s}){const a=st(t,s);return e.jsxs("div",{className:"bg-gray-50 p-4 rounded-md",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Coefficient inclinaison/orientation"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:a.toFixed(2)}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:a>=1.1?"Excellent":a>=1?"Très bon":a>=.9?"Bon":a>=.8?"Acceptable":"Sous-optimal"})]})}function qs({params:t,onChange:s,onSelectChange:a,onParamsChange:n}){const o=i=>{const c=Math.ceil(i*1e3/t.puissanceModules);n({nombreModules:c})},r=i=>()=>{n({[i]:!t[i]})},l=i=>()=>{const c={microinverter:"https://drive.google.com/file/d/1eHC5DfxUCI9eGWikzXL2Adee7mmUS_EL/view?usp=drive_link",bifacial:"https://drive.google.com/file/d/159O_va1W0Y2NBpUiJw-tt-wIQAgIq02l/view"};window.open(c[i],"_blank")};return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Installation"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(Ls,{value:t.nombreModules*t.puissanceModules/1e3,onChange:o,typeCompteur:t.typeCompteur}),e.jsx(O,{label:"Nombre de modules",name:"nombreModules",value:t.nombreModules,onChange:s,min:1,max:100,disabled:!0}),e.jsx(K,{label:"Inclinaison",name:"inclinaison",value:t.inclinaison,onChange:a,options:Os,unit:"°"}),e.jsx(K,{label:"Orientation",name:"orientation",value:t.orientation,onChange:a,options:at}),e.jsx(ue,{label:"Pertes système",name:"pertes",value:t.pertes,onChange:s,min:0,max:100,unit:"%",tooltipContent:"Les pertes système incluent les pertes dues aux câbles électriques, à la conversion DC/AC par l'onduleur, aux salissures sur les panneaux, et aux variations de température."}),e.jsx(K,{label:"Masque solaire",name:"masqueSolaire",value:t.masqueSolaire,onChange:a,options:$s}),e.jsx("div",{className:"md:col-span-2 space-y-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-6",children:[e.jsxs("div",{className:"flex-1 bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Micro-onduleurs"}),e.jsx(Y,{content:"Les micro-onduleurs optimisent la production de chaque panneau individuellement et augmentent la fiabilité du système"})]}),e.jsx("button",{type:"button",role:"switch","aria-checked":t.microOnduleurs||!1,onClick:r("microOnduleurs"),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-300 focus:ring-offset-2 ${t.microOnduleurs?"bg-blue-400":"bg-gray-200"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${t.microOnduleurs?"translate-x-6":"translate-x-1"}`})})]}),e.jsxs("button",{onClick:l("microinverter"),className:"mt-2 text-sm text-blue-600 hover:text-blue-800 flex items-center gap-1",children:[e.jsx($,{className:"h-4 w-4"}),"Fiche technique"]})]}),e.jsxs("div",{className:"flex-1 bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Technologie bifacial"}),e.jsx(Y,{content:"Les panneaux bifaciaux captent la lumière des deux côtés, augmentant la production jusqu'à 10% selon les conditions d'installation"})]}),e.jsx("button",{type:"button",role:"switch","aria-checked":t.bifacial||!1,onClick:r("bifacial"),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-300 focus:ring-offset-2 ${t.bifacial?"bg-blue-400":"bg-gray-200"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${t.bifacial?"translate-x-6":"translate-x-1"}`})})]}),e.jsxs("button",{onClick:l("bifacial"),className:"mt-2 text-sm text-blue-600 hover:text-blue-800 flex items-center gap-1",children:[e.jsx($,{className:"h-4 w-4"}),"Fiche technique"]})]})]})}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(zs,{orientation:t.orientation,inclinaison:t.inclinaison})})]})]})}function ot({result:t,onModifyPower:s}){return e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-8",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Résultats estimés"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Production annuelle"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[t.productionAnnuelle.toLocaleString()," kWh/an"]})]}),e.jsxs("div",{className:"relative bg-blue-50 p-4 rounded-lg group",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Puissance crête"}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[t.puissanceCrete.toFixed(1)," kWc"]}),s&&e.jsx("button",{onClick:s,className:"text-sm text-blue-600 hover:text-blue-800 opacity-0 group-hover:opacity-100 transition-opacity",children:"Modifier"})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Surface totale"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[t.surfaceTotale.toFixed(1)," m²"]})]})]})]})}function Hs({onReset:t,canProceed:s,result:a}){const n=U(),o=W(),{clientInfo:r}=_(),l=!!(r.civilite&&r.nom&&r.prenom&&r.telephone&&r.email),i=()=>{if(!l){alert("Veuillez remplir tous les champs obligatoires avant de continuer.");return}if(!a){alert("Veuillez attendre la fin du calcul avant de continuer.");return}const c=o.state||{};n("/projection",{state:{...c,productionAnnuelle:a.productionAnnuelle,puissanceCrete:a.puissanceCrete,surfaceTotale:a.surfaceTotale}}),z()};return e.jsxs("div",{className:"flex justify-between items-center mt-8 pt-4 border-t border-gray-200",children:[e.jsxs("button",{type:"button",onClick:t,className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Réinitialiser"]}),e.jsxs("button",{type:"button",disabled:!s||!l,onClick:i,className:`inline-flex items-center px-6 py-2 shadow-sm text-sm font-medium rounded-md text-white transition-colors
          ${s&&l?"bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500":"bg-gray-300 cursor-not-allowed"}`,children:["Continuer",e.jsx(fe,{className:"h-4 w-4 ml-2"})]})]})}function Vs({codePostal:t}){if(!t)return null;const s=t.substring(0,2),a=ke(s);return e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-yellow-50 p-4 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(J,{className:"h-6 w-6 text-yellow-500"}),e.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Ensoleillement de votre région",e.jsx(Y,{content:"Données issues de PVGIS (Photovoltaic Geographical Information System) de la Commission Européenne. L'ensoleillement est mesuré sur une surface horizontale en kWh/m²/an."})]})]}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-3xl font-bold text-blue-600",children:a.toLocaleString()}),e.jsx("span",{className:"text-gray-600",children:"kWh/m²/an"})]}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:a>=1500?"Excellent potentiel solaire":a>=1300?"Très bon potentiel solaire":a>=1100?"Bon potentiel solaire":"Potentiel solaire modéré"})]})}function lt(){const[t,s]=m.useState(()=>{const r=localStorage.getItem("solarParams");if(r){const l=JSON.parse(r);return l.orientation=Number(l.orientation),l}return $e}),[a,n]=m.useState(()=>{const r=localStorage.getItem("solarResult");return r?JSON.parse(r):null});return m.useEffect(()=>{localStorage.setItem("solarParams",JSON.stringify(t)),localStorage.setItem("orientation",t.orientation.toString()),localStorage.setItem("orientationLabel",rt(t.orientation))},[t]),m.useEffect(()=>{a&&localStorage.setItem("solarResult",JSON.stringify(a))},[a]),{params:t,setParams:s,result:a,setResult:n,resetData:()=>{s($e),n(null),localStorage.removeItem("solarParams"),localStorage.removeItem("solarResult"),localStorage.removeItem("orientation"),localStorage.removeItem("orientationLabel")}}}function Ws(){U();const{clientInfo:t,updateClientInfo:s,address:a,updateAddress:n,resetClientInfo:o}=_(),{params:r,setParams:l,result:i,setResult:c,resetData:d}=lt(),[u,g]=m.useState(!1),[x,p]=m.useState(null);m.useEffect(()=>{const f=setTimeout(async()=>{if(!r.adresse.codePostal||!r.consommationAnnuelle){c(null);return}g(!0),p(null);try{const C=await vs(r),h=As({consommationAnnuelle:r.consommationAnnuelle,codePostal:r.adresse.codePostal,typeCompteur:r.typeCompteur});c({...C,recommandation:h}),localStorage.setItem("solarResults",JSON.stringify(C))}catch(C){console.error("Erreur de calcul:",C),p(C instanceof Error?C.message:"Erreur de calcul"),c(null)}finally{g(!1)}},500);return()=>clearTimeout(f)},[r,c]);const y=()=>{o(),d(),c(null),g(!1),p(null)},k=b=>{const{name:f,value:C}=b.target,h=parseFloat(C);Number.isNaN(h)||l(P=>({...P,[f]:h}))},j=b=>{const{name:f,value:C}=b.target;l(h=>({...h,[f]:C}))},N=b=>{const{name:f,value:C}=b.target;s({[f]:C})},w=(b,f)=>{n({[b]:f}),l(C=>({...C,adresse:{...C.adresse,[b]:f}}))};return e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Estimez votre production d'énergie solaire"}),e.jsx("p",{className:"text-gray-600",children:"Calculez le potentiel de production d'énergie solaire de votre installation en fonction de vos paramètres spécifiques."})]}),e.jsxs("form",{onSubmit:b=>b.preventDefault(),className:"space-y-8",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Informations personnelles"}),e.jsxs("div",{className:"relative group",children:[e.jsx("button",{type:"button",onClick:y,className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors",children:e.jsx(ne,{className:"h-5 w-5"})}),e.jsx("div",{className:"absolute right-0 top-full mt-2 px-2 py-1 bg-gray-900 text-white text-sm rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap",children:"Réinitialiser"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Civilité"}),e.jsxs("select",{name:"civilite",value:t.civilite,onChange:N,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Sélectionner"}),e.jsx("option",{value:"M",children:"Monsieur"}),e.jsx("option",{value:"Mme",children:"Madame"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nom"}),e.jsx("input",{type:"text",name:"nom",value:t.nom,onChange:N,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Prénom"}),e.jsx("input",{type:"text",name:"prenom",value:t.prenom,onChange:N,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Téléphone"}),e.jsx("input",{type:"tel",name:"telephone",value:t.telephone,onChange:N,placeholder:"06 12 34 56 78",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",name:"email",value:t.email,onChange:N,placeholder:"exemple@email.com",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]})]})]}),e.jsx(Rs,{address:r.adresse,onChange:w}),r.adresse.codePostal&&e.jsx(Vs,{codePostal:r.adresse.codePostal}),e.jsx(_s,{typeCompteur:r.typeCompteur,consommationAnnuelle:r.consommationAnnuelle,onTypeCompteurChange:j,onConsommationChange:k}),(i==null?void 0:i.recommandation)&&e.jsx(Fs,{recommendation:i.recommandation,consommationAnnuelle:r.consommationAnnuelle,departement:r.adresse.codePostal.substring(0,2)}),e.jsx(qs,{params:r,onChange:k,onSelectChange:j,onParamsChange:b=>l(f=>({...f,...b}))}),u?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"inline-block animate-spin h-8 w-8 border-4 border-blue-500 rounded-full border-t-transparent"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Calcul en cours..."})]}):x?e.jsx("div",{className:"bg-red-50 p-4 rounded-md text-red-800",children:x}):i&&e.jsx(ot,{result:i}),e.jsx(Hs,{onReset:y,canProceed:!!i&&!u&&!x,result:i})]})]})}const Us={25:{2.5:49,3:59,3.5:68.5,4:78,4.5:87,5:96,5.5:105.5,6:115,6.5:124,7:132,7.5:140,8:149,8.5:158,9:167},20:{2.5:51.6,3:63.6,3.5:72,4:82.8,4.5:92,5:100.8,5.5:111.6,6:120,6.5:129.6,7:138,7.5:146.4,8:156,8.5:164.4,9:174},15:{2.5:56.4,3:73.2,3.5:80.4,4:91.2,4.5:102,5:111.6,5.5:122.4,6:130.8,6.5:142.8,7:150,7.5:159.6,8:169.2,8.5:177.6,9:189.6},10:{2.5:67.2,3:86.4,3.5:97.2,4:106.8,4.5:120,5:134.4,5.5:144,6:153.6,6.5:165.6,7:174,7.5:178.8,8:192,8.5:200.4,9:206.4}},Bs={2.5:6890,3:7890,3.5:8890,4:9890,4.5:10890,5:11890,5.5:12890,6:14890,6.5:15890,7:16890,7.5:17890,8:18890,8.5:19890,9:19890};function Se(t){var a;const s=Math.round(t*2)/2;if(s<=9)return Bs[s]||0;try{const n=localStorage.getItem("installation_prices");if(!n)return 0;const o=JSON.parse(n);if(!Array.isArray(o))return console.error("Format de prix invalide dans le localStorage"),0;const r=o.find(i=>Math.abs(i.power-s)<.01);if(r!=null&&r.price)return r.price;const l=o.sort((i,c)=>Math.abs(i.power-s)-Math.abs(c.power-s));return(a=l[0])!=null&&a.price?(console.log(`Utilisation du prix le plus proche : ${l[0].power} kWc pour ${s} kWc`),l[0].price):0}catch(n){return console.error("Erreur lors de la lecture des prix:",n),0}}function me(t,s){var n;const a=Math.round(t*2)/2;return((n=Us[s.toString()])==null?void 0:n[a])||0}function Gs(t){return t<=3?Math.round(t*1e3*.22):t<=9?Math.round(t*1e3*.16):t<=36?Math.round(t*1e3*.11):t<=100?Math.round(t*1e3*.08):0}function it(t,s,a){const n=Se(t);if(n===0)return console.error(`Impossible de trouver un prix pour la puissance ${t} kWc`),0;const o=Gs(t),r=Math.round(n*a/100);return n-o-r}function Ks({selectedMode:t,onModeChange:s,puissanceCrete:a,dureeAbonnement:n,onDureeChange:o,onKitSelect:r}){const l=me(a,n),[i,c]=m.useState(""),[d,u]=m.useState(null),[g,x]=m.useState([]),[p,y]=m.useState(null),k=a>9;m.useEffect(()=>{k&&t==="subscription"&&s("cash")},[k,t,s]),m.useEffect(()=>{const h=localStorage.getItem("revenuFiscal");h&&(c(h),w(parseInt(h,10)))},[l]);const j=h=>{const P=[25,20,15,10],E=[2.5,3,3.5,4,4.5,5,5.5,6],S=[];for(const M of E)for(const R of P){const D=me(M,R),Z=D*12/h*100;Z<=4&&S.push({power:M,duration:R,monthlyPayment:D,annualRatio:Z})}return S.sort((M,R)=>R.power-M.power)},N=h=>{if(h<=0)return null;const P=l*12,E=Math.ceil(P/.04);return h>=E},w=h=>{if(h>0&&t==="subscription"){const P=N(h);if(u(P),P)x([]);else{const E=j(h);x(E)}}else u(null),x([])},b=h=>{const P=h.target.value.replace(/\D/g,"");if(c(P),P){localStorage.setItem("revenuFiscal",P);const E=parseInt(P,10);w(E)}else localStorage.removeItem("revenuFiscal"),u(null),x([]);y(null)},f=h=>{y(h)},C=()=>{p&&r&&(u(!0),r(p))};return m.useEffect(()=>{t==="cash"&&(c(""),u(null),x([]),y(null),localStorage.removeItem("revenuFiscal"))},[t]),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Mode de financement"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{role:"button",tabIndex:0,onClick:()=>s("cash"),onKeyPress:h=>h.key==="Enter"&&s("cash"),className:`relative p-6 rounded-lg border-2 text-left transition-colors cursor-pointer
            ${t==="cash"?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(Ze,{className:`h-5 w-5 ${t==="cash"?"text-blue-500":"text-gray-400"}`}),e.jsx("span",{className:"font-medium",children:"Paiement comptant"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Investissez une fois et profitez d'économies maximales dès le premier jour"})]}),e.jsxs("div",{role:"button",tabIndex:0,onClick:()=>!k&&s("subscription"),onKeyPress:h=>h.key==="Enter"&&!k&&s("subscription"),className:`relative p-6 rounded-lg border-2 text-left transition-colors ${k?"opacity-50 cursor-not-allowed border-gray-200":t==="subscription"?"border-blue-500 bg-blue-50 cursor-pointer":"border-gray-200 hover:border-gray-300 cursor-pointer"}`,children:[k&&e.jsx("div",{className:"absolute inset-0 bg-gray-100 bg-opacity-50 flex items-center justify-center rounded-lg",children:e.jsx("div",{className:"bg-white px-4 py-2 rounded-full text-sm text-gray-600 shadow",children:"Non disponible pour puissance > 9 kWc"})}),e.jsx("div",{className:"absolute -top-2 right-2 bg-green-500 text-white text-xs px-2 py-1 rounded-full",children:"Plus populaire"}),e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(ye,{className:`h-5 w-5 ${t==="subscription"?"text-blue-500":"text-gray-400"}`}),e.jsx("span",{className:"font-medium",children:"Abonnement mensuel"})]}),t==="subscription"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsxs("span",{className:"text-2xl font-bold text-blue-600",children:[l.toFixed(2)," €"]}),e.jsx("span",{className:"text-gray-500",children:"/mois"})]})}),e.jsx("div",{className:"grid grid-cols-4 gap-2 mb-4",children:[10,15,20,25].map(h=>e.jsxs("div",{role:"button",tabIndex:0,onClick:()=>o(h),onKeyPress:P=>P.key==="Enter"&&o(h),className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors cursor-pointer text-center
                      ${n===h?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[h," ans"]},h))}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs(H,{to:"/modalites-abonnement",onClick:()=>z(),className:"inline-flex items-center text-blue-600 hover:text-blue-800 font-medium",children:["Voir les avantages de l'abonnement",e.jsx(fe,{className:"h-4 w-4 ml-1"})]}),e.jsx(H,{to:"/modalites-sortie",onClick:()=>z(),className:"block text-sm text-blue-600 hover:text-blue-800",children:"Consulter les modalités de sortie"})]})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-4",children:"Répartissez votre investissement sur la durée et commencez à économiser immédiatement"})]})]}),t==="subscription"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Services inclus dans votre abonnement :"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("li",{children:"• Maintenance préventive et curative 7j/7"}),e.jsxs("li",{children:["• Garantie pièces et main d'œuvre pendant ",n," ans"]}),e.jsx("li",{children:"• Monitoring et optimisation de performance"}),e.jsx("li",{children:"• Assurance tous risques incluse"}),e.jsx("li",{children:"• Pas d'apport initial"}),e.jsx("li",{children:"• Réponse sous 48h"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Revenu fiscal de référence",e.jsxs("div",{className:"relative inline-block ml-2 group",children:[e.jsx(V,{className:"h-4 w-4 text-gray-400 cursor-help"}),e.jsxs("div",{className:"absolute z-10 invisible group-hover:visible bg-gray-900 text-white text-sm rounded-lg py-2 px-3 w-72 bottom-full left-1/2 -translate-x-1/2 mb-2",children:[e.jsx("div",{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 w-2 h-2 bg-gray-900 rotate-45"}),`Le revenu fiscal de référence se trouve sur votre dernier avis d'imposition, en première page dans le cadre "Vos références".`]})]})]}),e.jsx("input",{type:"text",value:i,onChange:b,placeholder:"Montant en euros",className:`mt-1 block w-full rounded-md shadow-sm focus:ring-2 ${d===!0?"border-green-300 focus:border-green-500 focus:ring-green-500":d===!1?"border-amber-300 focus:border-amber-500 focus:ring-amber-500":"border-gray-300 focus:border-blue-500 focus:ring-blue-500"}`}),i&&parseInt(i,10)>0&&e.jsxs(e.Fragment,{children:[d===!0&&e.jsxs("div",{className:"mt-4 p-4 bg-green-50 border border-green-200 rounded-lg flex items-start gap-3",children:[e.jsx(de,{className:"h-5 w-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-green-800",children:[e.jsx("p",{className:"font-medium",children:"Vous êtes éligible à cet abonnement"}),e.jsxs("p",{className:"mt-1",children:["Votre revenu vous permet de souscrire à cette offre en toute sérénité. L'abonnement mensuel de ",A(l),"représente moins de 4% de votre revenu annuel."]})]})]}),d===!1&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mt-4 p-4 bg-amber-50 border border-amber-200 rounded-lg flex items-start gap-3",children:[e.jsx(Je,{className:"h-5 w-5 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-amber-800",children:[e.jsx("p",{className:"font-medium",children:"Kit solaire trop puissant pour votre budget"}),e.jsxs("p",{className:"mt-1",children:["Pour un abonnement mensuel de ",A(l),", votre revenu fiscal doit être d'au moins ",A(Math.ceil(l*12/.04)),". Voici les kits solaires adaptés à votre budget :"]})]})]}),g.length>0&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:g.slice(0,4).map((h,P)=>e.jsxs("div",{onClick:()=>f(h),className:`bg-white rounded-lg p-4 border transition-all cursor-pointer ${p===h?"border-blue-500 ring-2 ring-blue-200":"border-gray-200 hover:border-gray-300 hover:shadow-md"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(we,{className:`h-5 w-5 ${p===h?"text-blue-500":"text-green-500"}`}),e.jsxs("h4",{className:"font-medium text-gray-900",children:["Kit ",h.power," kWc"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["• Durée : ",h.duration," ans"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["• Mensualité : ",A(h.monthlyPayment)]}),e.jsxs("p",{className:"text-sm text-green-600",children:["• ",h.annualRatio.toFixed(1),"% de votre revenu annuel"]})]})]},`${h.power}-${h.duration}`))}),p&&e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:C,className:"inline-flex items-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:[e.jsx(de,{className:"h-5 w-5"}),"Valider ce kit"]})})]})]})]})]})]})]})}function Js({parameters:t,onParameterChange:s,puissanceCrete:a}){const[n,o]=m.useState(!1),{settings:r}=re(),l=p=>{const{name:y,value:k}=p.target;let j=parseFloat(k);switch(y){case"remiseCommerciale":j=Math.min(Math.max(0,j),10);break;case"revalorisationEnergie":j=Math.min(Math.max(0,j),10);break;case"indexationProduction":j=Math.min(Math.max(-5,j),3);break}s({[y]:j})},i=Se(a),c=i*t.remiseCommerciale/100,d=i-c,u=it(a,t.primeAutoconsommation,t.remiseCommerciale);let g="",x="";try{if(r.subsidyDate){const p=new Date(r.subsidyDate);isNaN(p.getTime())||(g=new Intl.DateTimeFormat("fr-FR",{day:"numeric",month:"long",year:"numeric"}).format(p))}if(r.sellPriceDate){const p=new Date(r.sellPriceDate);isNaN(p.getTime())||(x=new Intl.DateTimeFormat("fr-FR",{day:"numeric",month:"long",year:"numeric"}).format(p))}}catch(p){console.error("Erreur lors du formatage de la date:",p),g="Date non disponible",x="Date non disponible"}return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Paramètres financiers"}),e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[t.financingMode==="cash"&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("span",{className:"text-gray-700",children:"Prix de base TTC"}),e.jsx("span",{className:"font-semibold",children:A(i)})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(O,{label:"Remise commerciale",name:"remiseCommerciale",value:t.remiseCommerciale,onChange:l,min:0,max:10,step:1,unit:"%"}),t.remiseCommerciale>0&&e.jsxs("div",{className:"flex justify-between items-center text-gray-700",children:[e.jsx("span",{children:"Prix TTC remisé"}),e.jsx("span",{className:"font-semibold",children:A(d)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-700",children:"Prime à l'autoconsommation"}),e.jsx(Y,{content:`Prime en vigueur au ${g} pour les installations en autoconsommation avec revente de surplus`,children:e.jsx(se,{className:"h-4 w-4 text-gray-400 cursor-help"})})]}),e.jsx("span",{className:"font-semibold text-green-600",children:A(t.primeAutoconsommation)})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-200 flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-700",children:"Prix final TTC"}),e.jsx("span",{className:"text-xl font-bold text-blue-600",children:A(u)})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx(O,{label:"Prix du kWh",name:"prixKwh",value:t.prixKwh,onChange:l,min:0,max:1,step:.01,unit:"€/kWh"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Tarif de revente"}),e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"h-4 w-4 text-gray-400 cursor-help",onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1)}),n&&e.jsxs("div",{className:"absolute z-10 w-72 p-3 bg-gray-900 text-white text-sm rounded-lg -right-2 top-6",children:[e.jsx("div",{className:"absolute -top-1 right-3 w-2 h-2 bg-gray-900 rotate-45"}),e.jsxs("p",{children:["Tarif en vigueur au ",x," pour les installations en autoconsommation avec revente de surplus inférieures à 9kWc"]})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",name:"tarifRevente",value:t.tarifRevente,disabled:!0,className:"mt-1 block w-full rounded-md border-gray-300 bg-gray-100 text-gray-500 shadow-sm focus:border-gray-300 focus:ring-0 cursor-not-allowed disabled:bg-gray-100"}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"€/kWh"})})]})]}),e.jsx(O,{label:"Niveau d'autoconsommation",name:"autoconsommation",value:t.autoconsommation,onChange:l,min:0,max:100,unit:"%"}),e.jsx(O,{label:"Revalorisation annuelle",name:"revalorisationEnergie",value:t.revalorisationEnergie,onChange:l,min:0,max:10,unit:"%"}),e.jsx(ue,{label:"Indexation revente",name:"indexationProduction",value:t.indexationProduction,onChange:l,min:-5,max:3,step:.1,unit:"%",tooltipContent:"Évolution annuelle du tarif de revente de l'électricité"}),e.jsx(ue,{label:"Dégradation panneaux",name:"degradationPanneau",value:t.degradationPanneau,onChange:l,min:-2,max:0,step:.1,unit:"%",tooltipContent:"Dégradation annuelle de la production des panneaux solaires (-0.2% par défaut)"})]})]})]})}function Ys({projection:t}){const s=t.projectionAnnuelle[0].coutAbonnement>0,a=t.prixFinal;return e.jsxs("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Projection financière sur 30 ans"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Année"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Production (kWh)"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Autoconsommation"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Revente"}),s&&e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Abonnement"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Gain total"}),!s&&e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rendement"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.projectionAnnuelle.map(n=>{const o=s?0:(n.economiesAutoconsommation+n.revenusRevente)/a*100;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:n.annee}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900",children:Math.round(n.production).toString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-green-600",children:A(n.economiesAutoconsommation)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-blue-600",children:A(n.revenusRevente)}),s&&e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-red-600",children:n.coutAbonnement>0?A(-n.coutAbonnement):"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right font-medium text-gray-900",children:A(n.gainTotal)}),!s&&e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right font-medium text-emerald-600",children:[o.toFixed(1),"%"]})]},n.annee)})}),e.jsx("tfoot",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:"Total"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900",children:"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right font-medium text-green-600",children:A(t.totalAutoconsommation)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right font-medium text-blue-600",children:A(t.totalRevente)}),s&&e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right font-medium text-red-600",children:A(-t.totalAbonnement)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right font-medium text-gray-900",children:A(t.totalGains)}),!s&&e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right font-medium text-emerald-600",children:"-"})]})})]})})]})}const Zs={"Provence-Alpes-Côte d'Azur":1.2,Occitanie:1.15,"Nouvelle-Aquitaine":1.1,"Auvergne-Rhône-Alpes":1.05,Corse:1.2,"Bourgogne-Franche-Comté":.95,"Centre-Val de Loire":.95,"Grand Est":.9,"Hauts-de-France":.85,"Île-de-France":1.1,Normandie:.9,"Pays de la Loire":1,Bretagne:.95};function Xs({installedPower:t}){const[s,a]=m.useState(!1),{address:n}=_(),o=Math.max(0,t||0),r=n.region&&Zs[n.region]||1,l=o*r,i=Math.min(Math.max(0,l),10);return console.log("Property Value Calculation:",{installedPower:t,baseIncrease:o,region:n.region,regionalCoefficient:r,adjustedIncrease:l,estimatedIncrease:i}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(ss,{className:"h-6 w-6 text-purple-500"}),e.jsx("h4",{className:"font-medium text-gray-900",children:"Plus-value immobilière"})]}),e.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:["+",i.toFixed(1),"%"]}),e.jsxs("div",{className:"relative",children:[e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:["Valeur verte selon l'ADEME",n.region&&r!==1&&e.jsxs("span",{className:"text-purple-600",children:[" ","• Région ",n.region]})]}),e.jsxs("div",{className:"absolute right-0 top-0 cursor-help",onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),children:[e.jsx(se,{className:"h-4 w-4 text-gray-400"}),s&&e.jsxs("div",{className:"absolute z-10 w-72 p-3 bg-gray-900 text-white text-sm rounded-lg -right-2 top-6 shadow-xl",children:[e.jsx("div",{className:"absolute -top-1 right-3 w-2 h-2 bg-gray-900 rotate-45"}),e.jsx("p",{className:"mb-2",children:"Estimation basée sur des études nationales (ADEME, notaires) :"}),e.jsxs("ul",{className:"space-y-1 text-gray-300 text-xs",children:[e.jsx("li",{children:"• 1% de plus-value par kWc installé"}),e.jsxs("li",{children:["• Coefficient régional : ",r.toFixed(2)]}),e.jsx("li",{children:"• Varie selon l'attractivité du marché local"}),e.jsx("li",{children:"• Dépend des caractéristiques du bien"}),e.jsx("li",{children:"• Estimation non contractuelle"})]})]})]})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Label HPE (Haute Performance Énergétique)"})]})}function Qs(t){const s=Math.round(t/.2),a=Math.round(t/25),n=(t/1e3).toFixed(1);return`${s.toString()} km en voiture
          ou ${a} arbres plantés
          ou ${n} vols Paris-New York`}function en({projection:t}){const s=t.projectionAnnuelle.slice(0,20),a=s.reduce((d,u)=>d+u.economiesAutoconsommation,0)/20,n=s.reduce((d,u)=>d+u.revenusRevente,0)/20,o=a+n,r=t.projectionAnnuelle[0].coutAbonnement>0,l=r?null:o/t.prixFinal*100,i=Math.round(t.projectionAnnuelle[0].production*.06),c=t.prixInstallation?Math.round(t.prixInstallation/2500):0;return console.log("ProjectionSummary - puissanceCrete:",{prixInstallation:t.prixInstallation,calculatedPower:c}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-green-50 rounded-lg shadow-lg p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Synthèse financière"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-white p-5 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(et,{className:"h-6 w-6 text-green-500"}),e.jsx("h4",{className:"font-medium text-gray-900",children:"Revenus moyens annuels (sur 20 ans)"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:A(o)}),e.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:[e.jsxs("p",{children:["• Économies : ",A(a)]}),e.jsxs("p",{children:["• Revente : ",A(n)]}),!r&&l&&e.jsxs("p",{className:"mt-2 text-emerald-600 font-medium",children:["Rendement moyen : ",l.toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"bg-white p-5 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(Ne,{className:"h-6 w-6 text-blue-500"}),e.jsx("h4",{className:"font-medium text-gray-900",children:"Gains totaux sur 30 ans"})]}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:A(t.totalGains)}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Cumul des économies et de la revente"})]}),e.jsxs("div",{className:"bg-white p-5 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(Xe,{className:"h-6 w-6 text-emerald-500"}),e.jsx("h4",{className:"font-medium text-gray-900",children:"Impact environnemental"})]}),e.jsxs("p",{className:"text-2xl font-bold text-emerald-600",children:[i.toString()," kg"]}),e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:["CO₂ économisé par an, équivalent à :",Qs(i)]})]}),e.jsx(Xs,{installedPower:t.projectionAnnuelle[0].production/1100})]})]})}function tn(t,s,a,n){const o=Math.pow(1+t.degradationPanneau/100,s-1),r=Math.pow(1+t.indexationProduction/100,s-1),l=Math.pow(1+t.revalorisationEnergie/100,s-1),i=a*o,c=i*(t.autoconsommation/100),d=i-c,u=t.prixKwh*l,g=s<=20?t.tarifRevente*r:0,x=c*u,p=d*g,y=t.dureeAbonnement||20,k=t.financingMode==="subscription"&&s<=y?me(n,y)*12:0;return{annee:s,production:i,autoconsommation:c,revente:d,economiesAutoconsommation:x,revenusRevente:p,coutAbonnement:k,gainTotal:x+p-k}}function sn(t,s,a){const n=[];let o=0,r=0,l=0,i=0;for(let p=1;p<=30;p++){const y=tn(t,p,s,a);n.push(y),o+=y.economiesAutoconsommation,r+=y.revenusRevente,l+=y.coutAbonnement,i+=y.gainTotal}const c={autoconsommation:o/30,revente:r/30,abonnement:l/30,total:i/30},d=Se(a),u=it(a,t.primeAutoconsommation,t.remiseCommerciale);let g=0,x=0;for(let p=0;p<n.length;p++)g+=n[p].gainTotal,g>=u&&x===0&&(x=p+1);return{projectionAnnuelle:n,totalAutoconsommation:o,totalRevente:r,totalAbonnement:l,totalGains:i,moyenneAnnuelle:c,anneeRentabilite:x,prixInstallation:d,primeAutoconsommation:t.primeAutoconsommation,remiseCommerciale:t.remiseCommerciale,prixFinal:u}}function ct(){const{settings:t}=re(),[s,a]=m.useState(()=>({financingMode:"subscription",prixKwh:t.baseKwhPrice,tarifRevente:t.baseSellPrice,autoconsommation:t.defaultAutoconsumption,revalorisationEnergie:t.defaultEnergyRevaluation,indexationProduction:t.defaultSellIndexation,degradationPanneau:t.defaultPanelDegradation,dureeAbonnement:20,primeAutoconsommation:0,remiseCommerciale:0})),[n,o]=m.useState(null);m.useEffect(()=>{a(i=>({...i,prixKwh:t.baseKwhPrice,tarifRevente:t.baseSellPrice,autoconsommation:t.defaultAutoconsumption,revalorisationEnergie:t.defaultEnergyRevaluation,indexationProduction:t.defaultSellIndexation,degradationPanneau:t.defaultPanelDegradation}))},[t]),m.useEffect(()=>{const i=c=>{a(d=>({...d,...c.detail}))};return window.addEventListener("financialSettingsUpdated",i),()=>{window.removeEventListener("financialSettingsUpdated",i)}},[]);const r=m.useCallback(i=>{a(c=>({...c,...i}))},[]),l=m.useCallback((i,c)=>{const d=sn(s,i,c);o(d)},[s]);return{parameters:s,projection:n,updateParameters:r,calculateProjection:l}}function nn(){const t=U(),s=W(),[a,n]=m.useState(!1),[o,r]=m.useState(!1),[l,i]=m.useState(!1),[c,d]=m.useState(null);_();const{projection:u,parameters:g,updateParameters:x,calculateProjection:p}=ct();m.useEffect(()=>{const f=localStorage.getItem("solarResults");if(!f){t("/");return}(async()=>{var h,P;try{const E=JSON.parse(f);if(!E.typeCompteur){console.error("Type de compteur manquant dans les résultats"),t("/");return}d(E);const{productionAnnuelle:S,puissanceCrete:M}=E,R=((h=s.state)==null?void 0:h.power)||localStorage.getItem("selectedPower"),D=((P=s.state)==null?void 0:P.duration)||localStorage.getItem("subscriptionDuration"),F=R?parseFloat(R):M;if(!S||!F){t("/");return}const Z=F<=3?.22:.16,xt=Math.round(Z*F*1e3);x({productionAnnuelle:S,puissanceCrete:F,primeAutoconsommation:xt,financingMode:"subscription",dureeAbonnement:D?parseInt(D):20}),localStorage.removeItem("selectedPower"),localStorage.removeItem("subscriptionDuration")}catch(E){console.error("Erreur lors du chargement des résultats:",E),t("/")}})()},[t,x,s.state]);const y=async()=>{!g.productionAnnuelle||!g.puissanceCrete||(n(!0),localStorage.setItem("financialMode",g.financingMode),localStorage.setItem("primeAutoconsommation",g.primeAutoconsommation.toString()),localStorage.setItem("remiseCommerciale",g.remiseCommerciale.toString()),g.dureeAbonnement&&localStorage.setItem("subscriptionDuration",g.dureeAbonnement.toString()),await new Promise(f=>setTimeout(f,1e3)),p(g.productionAnnuelle,g.puissanceCrete),r(!0),n(!1))},k=f=>{if(!(c!=null&&c.typeCompteur)){console.error("Type de compteur non défini");return}const C=c.typeCompteur==="monophase"?6:9;if(f>C){console.warn(`Puissance ${f} kWc supérieure à la limite ${C} kWc en ${c.typeCompteur}`);return}const h={...c,puissanceCrete:f,productionAnnuelle:Math.round(f*(c.productionAnnuelle/c.puissanceCrete)),surfaceTotale:Math.round(f*2.3*100)/100};d(h),localStorage.setItem("solarResults",JSON.stringify(h));const P=f<=3?.22:.16,E=Math.round(P*f*1e3);x({puissanceCrete:f,productionAnnuelle:h.productionAnnuelle,primeAutoconsommation:E})},j=f=>{k(f.power),x({dureeAbonnement:f.duration})},N=()=>{z(),t("/eligibilite")};if(!(c!=null&&c.typeCompteur))return null;const w=c.typeCompteur==="monophase"?6:9,b=Array.from({length:Math.floor((w-2.4)/.5)+1},(f,C)=>({value:2.5+C*.5,label:`${(2.5+C*.5).toFixed(1)} kWc`})).filter(f=>f.value<=w);return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"mb-6",children:e.jsxs(H,{to:"/",className:"inline-flex items-center text-sm text-gray-500 hover:text-gray-700",children:[e.jsx(ge,{className:"h-4 w-4 mr-1"}),"Retour au dimensionnement"]})}),e.jsxs("div",{className:"space-y-8",children:[e.jsx(ot,{result:c,onModifyPower:()=>i(!0)}),l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Ajuster la puissance"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Puissance (kWc)"}),e.jsx("select",{value:c.puissanceCrete,onChange:f=>k(parseFloat(f.target.value)),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:b.map(f=>e.jsx("option",{value:f.value,children:f.label},f.value))}),c.typeCompteur==="monophase"&&e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Limité à 6 kWc en monophasé"})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>i(!1),className:"px-4 py-2 text-gray-700 hover:text-gray-900",children:"Annuler"}),e.jsx("button",{onClick:()=>i(!1),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Appliquer"})]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-lg p-6",children:e.jsxs("div",{className:"space-y-8",children:[e.jsx(Ks,{selectedMode:g.financingMode,onModeChange:f=>x({financingMode:f}),puissanceCrete:g.puissanceCrete,dureeAbonnement:g.dureeAbonnement||20,onDureeChange:f=>x({dureeAbonnement:f}),onKitSelect:j}),e.jsx(Js,{parameters:g,onParameterChange:x,puissanceCrete:g.puissanceCrete}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{onClick:y,disabled:a,className:"relative px-6 py-3 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed group",children:e.jsx("div",{className:"flex items-center gap-2",children:a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"relative w-5 h-5",children:e.jsx(J,{className:"absolute inset-0 w-5 h-5 text-yellow-300 animate-spin"})}),e.jsx("span",{children:"Calcul en cours..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"w-5 h-5"}),e.jsx("span",{children:"Calculer la projection financière"})]})})})})]})}),o&&u&&!a&&e.jsxs(e.Fragment,{children:[e.jsx(Ys,{projection:u}),e.jsx(en,{projection:u}),e.jsxs("div",{className:"mt-8 space-y-6",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Pour toute demande d'étude d'éligibilité au dossier, nos conseillers sont à votre disposition :"}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-center items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rs,{className:"h-5 w-5 text-blue-600"}),e.jsx("a",{href:"tel:0183835150",className:"text-blue-600 hover:text-blue-800 font-medium",children:"01 83 83 51 50"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"h-5 w-5 text-blue-600"}),e.jsx("a",{href:"mailto:contact@abie.fr",className:"text-blue-600 hover:text-blue-800 font-medium",children:"contact@abie.fr"})]})]})]})}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:N,className:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:["Tester mon éligibilité",e.jsx(fe,{className:"ml-2 -mr-1 h-5 w-5"})]})})]})]})]})]})}const ze=[{icon:ye,title:"Réponse sous 48H",duration:"2 jours",description:"Étude initiale de votre dossier"},{icon:ls,title:"Étude technique",duration:"15 jours",description:"Analyse détaillée et dimensionnement"},{icon:$,title:"Démarches",duration:"30 jours",description:"Autorisations administratives"},{icon:hs,title:"Installation",duration:"45 jours",description:"Pose et mise en service"},{icon:as,title:"Monitoring",duration:"Permanent",description:"Suivi de production et maintenance"}],an=()=>{U(),_();const[t,s]=m.useState(""),[a,n]=m.useState(null),[o,r]=m.useState(null),[l,i]=m.useState([]),[c,d]=m.useState(null),[u,g]=m.useState(!1),x=N=>{const w=N.target.value.replace(/\D/g,"").slice(0,14);s(w)},p=N=>w=>{var f;const b=(f=w.target.files)==null?void 0:f[0];if(b){if(b.size>10*1024*1024){d("Le fichier est trop volumineux. Taille maximum : 10MB");return}N==="tax"?n(b):r(b),d(null)}},y=N=>{const f=Array.from(N.target.files||[]).filter(C=>C.size>10*1024*1024?(d("Une photo est trop volumineuse. Taille maximum : 10MB"),!1):!0).map(C=>({id:Math.random().toString(36).substr(2,9),file:C}));i(C=>[...C,...f]),d(null)},k=N=>{i(w=>w.filter(b=>b.id!==N))},j=()=>{g(!0)};return e.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-8 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"mb-6",children:e.jsxs(H,{to:"/projection",className:"inline-flex items-center text-sm text-gray-500 hover:text-gray-700",children:[e.jsx(ge,{className:"h-4 w-4 mr-1"}),"Retour à la projection financière"]})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Vérification d'éligibilité"}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg mb-8",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-6",children:"Étapes de votre installation"}),e.jsx("div",{className:"relative flex justify-between",children:ze.map((N,w)=>e.jsxs("div",{className:"relative flex flex-col items-center w-32",children:[w<ze.length-1&&e.jsx("div",{className:"absolute w-full h-[2px] top-7 left-[50%] bg-blue-200",style:{width:"calc(200% - 2rem)"}}),e.jsx("div",{className:"relative z-10 flex items-center justify-center w-14 h-14 bg-white rounded-full border-2 border-blue-500",children:e.jsx(N.icon,{className:"h-6 w-6 text-blue-500"})}),e.jsxs("div",{className:"mt-3 text-center",children:[e.jsx("span",{className:"inline-block px-3 py-1 bg-blue-50 text-blue-700 text-sm font-medium rounded-full mb-2",children:N.duration}),e.jsx("div",{className:"text-sm font-medium text-gray-900",children:N.title}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:N.description})]})]},w))})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Numéro PDL (Point De Livraison)",e.jsxs("div",{className:"relative inline-block ml-2 group",children:[e.jsx(V,{className:"h-4 w-4 text-gray-400 cursor-help"}),e.jsxs("div",{className:"absolute z-10 invisible group-hover:visible bg-gray-900 text-white text-sm rounded-lg py-2 px-3 w-72 bottom-full left-1/2 -translate-x-1/2 mb-2",children:[e.jsx("div",{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 w-2 h-2 bg-gray-900 rotate-45"}),"Le numéro PDL (Point De Livraison) est un identifiant unique de 14 chiffres qui se trouve sur votre facture d'électricité et sur votre compteur Linky."]})]})]}),e.jsx("input",{type:"text",value:t,onChange:x,placeholder:"14 chiffres",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",maxLength:14})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Avis d'imposition"}),e.jsxs("div",{className:`relative flex items-center justify-center p-6 border-2 border-dashed rounded-lg transition-colors ${a?"border-green-300 bg-green-50":"border-gray-300 hover:border-blue-500 bg-gray-50"}`,children:[e.jsx("input",{type:"file",className:"hidden",accept:".pdf,.jpg,.jpeg,.png",onChange:p("tax"),id:"tax-file"}),e.jsx("label",{htmlFor:"tax-file",className:"cursor-pointer text-center",children:a?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5 text-green-500"}),e.jsx("span",{className:"text-green-700",children:a.name})]}):e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(_e,{className:"h-8 w-8 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:"Cliquez pour sélectionner votre avis d'imposition"})]})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pièce d'identité"}),e.jsxs("div",{className:`relative flex items-center justify-center p-6 border-2 border-dashed rounded-lg transition-colors ${o?"border-green-300 bg-green-50":"border-gray-300 hover:border-blue-500 bg-gray-50"}`,children:[e.jsx("input",{type:"file",className:"hidden",accept:".pdf,.jpg,.jpeg,.png",onChange:p("id"),id:"id-file"}),e.jsx("label",{htmlFor:"id-file",className:"cursor-pointer text-center",children:o?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5 text-green-500"}),e.jsx("span",{className:"text-green-700",children:o.name})]}):e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(_e,{className:"h-8 w-8 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:"Cliquez pour sélectionner votre pièce d'identité"})]})})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Photos de l'environnement",e.jsxs("div",{className:"relative inline-block ml-2 group",children:[e.jsx(V,{className:"h-4 w-4 text-gray-400 cursor-help"}),e.jsxs("div",{className:"absolute z-10 invisible group-hover:visible bg-gray-900 text-white text-sm rounded-lg py-2 px-3 w-80 bottom-full left-1/2 -translate-x-1/2 mb-2",children:[e.jsx("div",{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 w-2 h-2 bg-gray-900 rotate-45"}),"Nous avons besoin de photos de : • Votre toit à équiper • L'environnement proche (arbres, bâtiments) • Les éventuels masques solaires (ombres portées)"]})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:l.map(N=>e.jsx("div",{className:"relative bg-gray-50 p-3 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ot,{className:"h-5 w-5 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600 truncate",children:N.file.name})]}),e.jsx("button",{type:"button",onClick:()=>k(N.id),className:"p-1 hover:bg-gray-200 rounded-full transition-colors",children:e.jsx(ps,{className:"h-4 w-4 text-gray-500"})})]})},N.id))}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("label",{className:"relative cursor-pointer",children:[e.jsx("input",{type:"file",className:"hidden",accept:"image/*",multiple:!0,onChange:y}),e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:[e.jsx(os,{className:"h-5 w-5 text-gray-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Ajouter des photos"})]})]})})]})]}),c&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-md",children:e.jsx("div",{className:"text-sm text-red-600",children:c})}),e.jsx("div",{className:"flex justify-center mt-8",children:e.jsx("button",{onClick:j,className:"px-6 py-3 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors",children:"Valider mon dossier"})}),e.jsxs("div",{className:"bg-blue-50 p-6 rounded-lg mt-8",children:[e.jsx("h4",{className:"text-lg font-medium text-blue-900 mb-4",children:"Besoin d'assistance ?"}),e.jsx("div",{className:"text-blue-700 mb-4",children:"Nos conseillers sont à votre disposition pour vous accompagner dans votre projet d'installation solaire."}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-blue-800",children:[e.jsx("span",{className:"font-medium",children:"Téléphone :"})," ",e.jsxs("span",{className:"relative group",children:[e.jsx("a",{href:"tel:0183835150",className:"hover:underline",children:"01 83 83 51 50"}),e.jsxs("div",{className:"absolute z-10 invisible group-hover:visible bg-gray-900 text-white text-sm rounded-lg py-2 px-3 w-64 bottom-full left-1/2 -translate-x-1/2 mb-2",children:[e.jsx("div",{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 w-2 h-2 bg-gray-900 rotate-45"}),e.jsxs("div",{className:"text-center",children:["Horaires d'ouverture :",e.jsx("br",{}),"Du lundi au vendredi",e.jsx("br",{}),"9H30 - 18H00"]})]})]})]}),e.jsxs("div",{className:"text-blue-800",children:[e.jsx("span",{className:"font-medium",children:"Email :"})," ",e.jsx("a",{href:"mailto:contact@abie.fr",className:"hover:underline",children:"contact@abie.fr"})]})]})]})]}),u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full overflow-hidden shadow-xl",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-1/2",children:e.jsx("img",{src:"https://i.ibb.co/GQr7gmd/maison-panneaux-solaires-toit.jpg",alt:"Maison avec panneaux solaires",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"w-1/2 p-6",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Félicitations !"}),e.jsx("div",{className:"text-gray-600 mb-4",children:"Bienvenue dans le monde de demain ! Vous venez de faire le premier pas vers une énergie plus propre et plus économique."}),e.jsx("div",{className:"text-gray-600 mb-6",children:"Notre équipe va étudier votre dossier et vous recevrez votre contrat d'abonnement sous 48H."}),e.jsx("button",{onClick:()=>g(!1),className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Fermer"})]})]})})})]})};async function rn(t,s,a,n,o){try{const r=new vt;r.setFontSize(20),r.text("Rapport Installation Solaire",105,20,{align:"center"}),r.setFontSize(10),r.setTextColor(100,100,100),r.text("Note : Cette simulation de productible est réalisée avec soin à partir des données disponibles, mais reste indicative et non contractuelle.",20,30,{maxWidth:170}),r.setTextColor(0,0,0),r.setFontSize(14),r.text("Informations client",20,45);const l=[["Civilité",n.civilite],["Nom",n.nom],["Prénom",n.prenom],["Adresse",n.adresse],["Code postal",n.codePostal],["Ville",n.ville],["Téléphone",n.telephone],["Email",n.email],["Point de livraison (PDL)",n.pdl||"Non renseigné"]];B(r,{startY:50,head:[["Information","Valeur"]],body:l,theme:"striped",headStyles:{fillColor:[41,128,185]},margin:{top:50}}),r.addPage(),r.setFontSize(14),r.text("Caractéristiques techniques",20,20);const i=[["Type de compteur",o.typeCompteur==="monophase"?"Monophasé":"Triphasé"],["Consommation annuelle",`${o.consommationAnnuelle.toString()} kWh/an`],["Puissance crête",`${o.puissanceCrete.toFixed(1)} kWc`],["Nombre de modules",o.nombreModules.toString()],["Surface totale",`${o.surfaceTotale.toFixed(1)} m²`],["Orientation",rt(o.orientation)],["Inclinaison",`${o.inclinaison}°`],["Pertes système",`${o.pertes}%`],["Masque solaire",`${o.masqueSolaire}%`],["Micro-onduleurs",o.microOnduleurs?"Oui":"Non"],["Technologie bifaciale",o.bifacial?"Oui":"Non"],["Production annuelle estimée",`${Math.round(a).toString()} kWh/an`]];B(r,{startY:25,head:[["Caractéristique","Valeur"]],body:i,theme:"striped",headStyles:{fillColor:[41,128,185]}}),r.text("Informations financières",20,r.lastAutoTable.finalY+20);const c=t.financingMode==="cash"?[["Type de financement","Paiement comptant"],["Prix de base TTC",A(s.prixInstallation)],["Remise commerciale",`${t.remiseCommerciale}%`],["Prime à l'autoconsommation",A(t.primeAutoconsommation)],["Prix final TTC",A(s.prixFinal)]]:[["Type de financement","Abonnement mensuel"],["Durée d'engagement",`${t.dureeAbonnement} ans`],["Mensualité TTC",A(s.projectionAnnuelle[0].coutAbonnement/12)],["Services inclus","Maintenance, garantie, monitoring et assurance"]];B(r,{startY:r.lastAutoTable.finalY+25,head:[["Information financière","Valeur"]],body:c,theme:"striped",headStyles:{fillColor:[41,128,185]}}),r.addPage(),r.setFontSize(14),r.text("Projection financière sur 20 ans",20,20);const d=s.projectionAnnuelle.slice(0,20).map(x=>[x.annee.toString(),Math.round(x.production).toString(),A(x.economiesAutoconsommation),A(x.revenusRevente),A(x.gainTotal)]);B(r,{startY:25,head:[["Année","Production (kWh)","Économies","Revente","Gain total"]],body:d,theme:"striped",headStyles:{fillColor:[41,128,185]}}),r.text("Synthèse financière",20,r.lastAutoTable.finalY+20);const u=[["Économies moyennes annuelles",A(s.moyenneAnnuelle.autoconsommation)],["Revente moyenne annuelle",A(s.moyenneAnnuelle.revente)],["Gain total sur 20 ans",A(s.totalGains)]];B(r,{startY:r.lastAutoTable.finalY+25,head:[["Indicateur","Montant"]],body:u,theme:"striped",headStyles:{fillColor:[41,128,185]}});const g=r.internal.getNumberOfPages();for(let x=1;x<=g;x++)r.setPage(x),r.setFontSize(10),r.setTextColor(150,150,150),r.text(`Page ${x} sur ${g}`,r.internal.pageSize.width-20,r.internal.pageSize.height-10);r.save("rapport-installation-solaire.pdf")}catch(r){throw console.error("Erreur lors de la génération du PDF:",r),r}}function on({params:t,projection:s,productionAnnuelle:a,clientInfo:n,installationParams:o}){const[r,l]=m.useState(!1),i=async()=>{l(!0);try{const c={...t,financingMode:t.financingMode||"subscription",prixKwh:t.prixKwh||.25,tarifRevente:t.tarifRevente||.1269,autoconsommation:t.autoconsommation||75,revalorisationEnergie:t.revalorisationEnergie||7,indexationProduction:t.indexationProduction||2,degradationPanneau:t.degradationPanneau||-.2,dureeAbonnement:t.dureeAbonnement||20,primeAutoconsommation:t.primeAutoconsommation||0,remiseCommerciale:t.remiseCommerciale||0};await rn(c,s,a,n,o)}catch(c){console.error("Erreur lors de la génération du PDF:",c),alert("Une erreur est survenue lors de la génération du PDF. Veuillez réessayer.")}finally{l(!1)}};return e.jsxs("button",{onClick:i,disabled:r,className:`inline-flex items-center gap-2 px-4 py-2 rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors ${r?"opacity-50 cursor-wait":""}`,children:[e.jsx(Xt,{className:"h-5 w-5"}),r?"Génération...":"Télécharger le rapport"]})}function ln(){const{clientInfo:t,address:s}=_(),{params:a}=lt(),[n,o]=m.useState(""),{parameters:r,projection:l,calculateProjection:i}=ct();m.useEffect(()=>{const g=localStorage.getItem("solarResults");if(g){const{productionAnnuelle:x,puissanceCrete:p}=JSON.parse(g),y=localStorage.getItem("financialMode"),k=localStorage.getItem("subscriptionDuration"),j=localStorage.getItem("primeAutoconsommation"),N=localStorage.getItem("remiseCommerciale");y&&(r.financingMode=y),k&&(r.dureeAbonnement=parseInt(k,10)),j&&(r.primeAutoconsommation=parseFloat(j)),N&&(r.remiseCommerciale=parseFloat(N)),i(x,p)}},[i,r]);const c=g=>{const x=g.target.value.replace(/\D/g,"").slice(0,14);o(x)},d=localStorage.getItem("solarResults")?JSON.parse(localStorage.getItem("solarResults")):null,u={civilite:t.civilite,nom:t.nom,prenom:t.prenom,adresse:s.rue||"",codePostal:s.codePostal||"",ville:s.ville||"",telephone:t.telephone,email:t.email,pdl:n};return e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"mb-6",children:e.jsxs(H,{to:"/projection",className:"inline-flex items-center text-sm text-gray-500 hover:text-gray-700",children:[e.jsx(ge,{className:"h-4 w-4 mr-1"}),"Retour à la projection financière"]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Rapport détaillé"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Informations client"}),e.jsxs("dl",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Nom complet"}),e.jsx("dd",{className:"text-sm text-gray-900",children:`${t.civilite} ${t.prenom} ${t.nom}`})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Téléphone"}),e.jsx("dd",{className:"text-sm text-gray-900",children:t.telephone})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Email"}),e.jsx("dd",{className:"text-sm text-gray-900",children:t.email})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Adresse"}),e.jsxs("dl",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Rue"}),e.jsx("dd",{className:"text-sm text-gray-900",children:s.rue||"-"})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Code postal"}),e.jsx("dd",{className:"text-sm text-gray-900",children:s.codePostal||"-"})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Ville"}),e.jsx("dd",{className:"text-sm text-gray-900",children:s.ville||"-"})]})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Numéro PDL (Point De Livraison)"}),e.jsxs("div",{className:"relative group",children:[e.jsx(V,{className:"h-4 w-4 text-gray-400 cursor-help"}),e.jsxs("div",{className:"absolute z-10 invisible group-hover:visible bg-gray-900 text-white text-sm rounded-lg py-2 px-3 w-72 bottom-full left-1/2 -translate-x-1/2 mb-2",children:[e.jsx("div",{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 w-2 h-2 bg-gray-900 rotate-45"}),"Le numéro PDL (Point De Livraison) est un identifiant unique de 14 chiffres qui se trouve sur votre facture d'électricité et sur votre compteur Linky."]})]})]}),e.jsx("input",{type:"text",value:n,onChange:c,placeholder:"14 chiffres",className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",maxLength:14}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Facultatif - Vous trouverez ce numéro sur votre facture d'électricité ou sur votre compteur Linky"})]}),e.jsx("div",{className:"flex justify-end",children:d&&l&&e.jsx(on,{params:r,projection:l,productionAnnuelle:d.productionAnnuelle,clientInfo:u,installationParams:{typeCompteur:a.typeCompteur,pdl:n,consommationAnnuelle:a.consommationAnnuelle,puissanceCrete:d.puissanceCrete,nombreModules:a.nombreModules,inclinaison:a.inclinaison,orientation:a.orientation,pertes:a.pertes,masqueSolaire:a.masqueSolaire||0,microOnduleurs:a.microOnduleurs||!1,bifacial:a.bifacial||!1,surfaceTotale:d.surfaceTotale}})})]})]})]})}const cn=[{title:"Un contrat flexible",icon:$,color:"blue",points:["Résiliation possible dès la 5ème année","Transfert gratuit en cas de vente","Évolution possible de l'installation"]},{title:"Service premium",icon:ts,color:"purple",points:["Service client basé en France","Accompagnement personnalisé","Suivi de production en temps réel"]},{title:"Garanties complètes",icon:ds,color:"green",points:["Maintenance gratuite jusqu'à 25 ans","Matériel garanti 30 ans","Assurance tous risques incluse"]},{title:"Haute performance",icon:Wt,color:"orange",points:["Panneaux dernière génération","Micro-onduleurs optimisés","Monitoring avancé"]},{title:"Financement simplifié",icon:Ze,color:"indigo",points:["Sans apport initial","Pas de crédit bancaire","Réponse sous 48h"]},{title:"Engagement durable",icon:Xe,color:"emerald",points:["Entreprise à mission","Transition énergétique","Production locale"]}];function dn(){return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-8",children:"Avantages de l'abonnement"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:cn.map(t=>e.jsx("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden hover:shadow-md transition-shadow duration-300",children:e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg bg-${t.color}-50`,children:e.jsx(t.icon,{className:`h-6 w-6 text-${t.color}-500`})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:t.title})]}),e.jsx("ul",{className:"space-y-3",children:t.points.map(s=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(de,{className:`h-5 w-5 text-${t.color}-500 flex-shrink-0 mt-0.5`}),e.jsx("span",{className:"text-gray-600",children:s})]},s))})]})},t.title))}),e.jsxs("div",{className:"mt-8 bg-blue-50 p-6 rounded-xl text-center",children:[e.jsx("p",{className:"text-lg font-medium text-blue-900",children:"Rejoignez les 100 000 premiers foyers abonnés !"}),e.jsx("p",{className:"mt-2 text-blue-700",children:"Profitez d'une installation solaire clé en main sans investissement initial"})]})]})}const qe=[{puissance:"2.5",mensualites:[49,51.6,56.4,67.2],remboursements:[["-",5269,5197,5108,5028,4978,4931,4910,4876,4827,4761,4675,4567,4433,4271,4076,3843,3569,3246,2870,2432,1924,1338,662,0],["-",5190,5071,4930,4937,4747,4685,4594,4476,4327,4144,3920,3649,3327,2944,2492,1961,1342,620,0],["-",5043,4916,4818,4636,4430,4191,3979,3721,3412,3044,2608,2095,775,0],["-",4714,4463,4164,3755,3387,2748,1893,863,0]]},{puissance:"3.0",mensualites:[59,63.6,73.2,86.4],remboursements:[["-",6951,6917,6855,6767,6625,6365,6251,6121,5971,5801,5608,5391,5148,4876,4572,4234,3860,3445,2988,2484,1929,1320,653,0],["-",6821,6711,6564,6382,6233,6054,5859,5633,5374,5077,4739,4356,3922,3432,2880,2260,1564,784,0],["-",6548,6280,6041,5760,5434,5055,4634,4154,3608,2989,2288,1495,1e3,0],["-",5982,5495,4942,4316,3609,2813,1930,1103,0]]},{puissance:"3.5",mensualites:[68.5,72,80.4,97.2],remboursements:[["-",7684,7619,7568,7471,7349,7227,7151,7055,6937,6794,6624,6423,6189,5917,5603,5244,4833,4366,3836,3236,2560,1799,944,0],["-",7582,7458,7339,7168,6962,6746,6558,6335,6073,5768,5413,5004,4534,3996,3382,2683,1889,989,0],["-",7192,7070,6915,6725,6493,6023,5608,5114,4530,3847,3051,2129,1068,0],["-",6641,6189,5663,5054,4351,3333,2352,1232,0]]},{puissance:"4.0",mensualites:[78,83,91,107],remboursements:[["-",8440,8346,8300,8194,8140,8064,7980,7874,7744,7586,7399,7178,6919,6620,6274,5878,5426,4912,4330,3671,2928,2093,1156,0],["-",8301,8125,7987,7778,7665,7469,7252,6997,6699,6353,5953,5493,4965,4363,3677,2896,2012,1010,0],["-",7977,7814,7612,7365,7068,6502,6062,5551,4963,4288,3514,2629,1251,0],["-",7452,6976,6421,5777,5033,3940,2935,1368,0]]},{puissance:"4.5",mensualites:[87,92,102,120],remboursements:[["-",9285,9165,9097,9065,9012,8850,8750,8624,8472,8290,8073,7820,7525,7185,6795,6348,5840,5265,4614,3880,3056,2131,1096,0],["-",9050,8879,8770,8629,8451,8232,7993,7711,7382,7e3,6559,6052,5471,4808,4052,3194,2222,1120,0],["-",8762,8559,8308,8005,7642,7058,6545,5952,5269,4485,3587,2560,1400,0],["-",8093,7496,6805,6009,5095,4049,2875,1538,0]]},{puissance:"5.0",mensualites:[96,100.8,111.6,134.4],remboursements:[["-",10322,10262,10178,10111,10065,9994,9906,9789,9641,9457,9233,8965,8647,8272,7835,7329,6744,6072,5302,4424,3424,2289,1002,0],["-",10183,10041,9864,9692,9527,9321,9075,8778,8426,8010,7523,6955,6299,5541,4670,3672,2531,1231,0],["-",9870,9543,9158,8750,8316,7807,7235,6576,5817,4948,3955,2821,1530,0],["-",9098,8492,7784,6959,6004,4827,3390,1724,0]]},{puissance:"5.5",mensualites:[105.5,111.6,122.4,144],remboursements:[["-",11283,11205,11074,10933,10860,10756,10641,10496,10317,10100,9841,9535,9177,8761,8281,7730,7099,6380,5564,4639,3595,2418,1094,0],["-",11106,10923,10674,10400,10176,9901,9606,9261,8859,8395,7861,7249,6550,5754,4850,3825,2667,1358,0],["-",10727,10490,10152,9760,9345,8387,7762,7047,6231,5301,4243,3042,1679,0],["-",9999,9392,8680,7848,6881,4815,3421,1845,0]]},{puissance:"6.0",mensualites:[115,120,130.8,153.6],remboursements:[["-",12342,12090,11922,11780,11626,11506,11377,11216,11019,10781,10498,10166,9778,9329,8812,8220,7544,6776,5906,4924,3817,2573,1177,0],["-",12194,11857,11592,11340,11147,10905,10620,10276,9867,9384,8817,8157,7391,6507,5489,4321,2985,1460,0],["-",11875,11535,11386,11190,10679,10091,9451,8665,7712,6573,5224,3640,1794,0],["-",11090,10463,9608,8805,7489,6139,4415,2400,0]]},{puissance:"6.5",mensualites:[124,129.6,142.8,165.6],remboursements:[["-",12885,12724,12661,12550,12429,12116,11983,11816,11610,11362,11066,10717,10310,9838,9294,8670,7958,7148,6230,5193,4025,2713,1242,0],["-",12347,12306,12232,12121,11968,11425,11122,10759,10328,9820,9227,8536,7737,6816,5756,4541,3152,1567,0],["-",12208,11880,11615,11285,10879,9842,9156,8353,7418,6332,5077,3629,1963,0],["-",11305,10628,9828,8889,7793,5694,4032,2124,0]]},{puissance:"7.0",mensualites:[132,138,150,174],remboursements:[["-",13300,13214,13093,12838,12620,12432,12250,12033,11776,11476,11128,10729,10272,9752,9165,8505,7765,6939,6021,5005,3884,2652,1303,0],["-",13124,12933,12692,12303,11933,11570,11206,10784,10298,9742,9109,8388,7572,6650,5611,4442,3131,1663,0],["-",12670,12291,11946,11524,11014,9958,9226,8388,7430,6336,5090,3673,2062,0],["-",11703,10910,9983,8904,7654,6118,4314,2231,0]]},{puissance:"7.5",mensualites:[140,146.4,159.6,178.8],remboursements:[["-",13790,13639,13534,13482,13393,13262,13124,12949,12731,12466,12149,11773,11332,10818,10225,9542,8761,7872,6861,5718,4429,2979,1353,0],["-",13602,13339,13164,12983,12746,12446,12116,11722,11254,10703,10060,9311,8445,7446,6297,4980,3474,1755,0],["-",13109,12843,12507,12092,11585,10973,10241,9371,8346,7143,5736,4099,2197,0],["-",12040,11159,10139,8961,7608,6059,4320,2291,0]]},{puissance:"8.0",mensualites:[149,156,169.2,192],remboursements:[["-",14529,14437,14274,14092,13783,13590,13405,13179,12909,12591,12220,11790,11295,10731,10090,9367,8553,7644,6630,5506,4265,2902,1411,0],["-",14321,14149,13861,13620,13383,13079,12744,12341,11860,11291,10622,9842,8936,7887,6676,5284,3688,1860,0],["-",13846,13563,13145,12651,12120,11477,10716,9813,8746,7493,6028,4319,2331,0],["-",12615,11701,10634,9394,7960,6204,4450,2464,0]]},{puissance:"8.5",mensualites:[158,164.4,177.6,200.4],remboursements:[["-",15135,14980,14710,14461,14292,14067,13855,13601,13300,12949,12543,12075,11542,10938,10257,9494,8643,7699,6657,5514,4268,2918,1466,0],["-",14945,14815,14668,14484,14313,13115,12702,12224,11673,11043,10324,9508,8584,7542,6370,5057,3589,1954,0],["-",14407,14092,13632,13090,12505,11153,10326,9387,8321,7112,5744,4196,2448,0],["-",13151,12196,11080,9784,8284,6449,4629,2572,0]]},{puissance:"9.0",mensualites:[167,174,189.6,206.4],remboursements:[["-",15706,15619,15524,15362,15179,14745,14554,14320,14038,13702,13309,12850,12322,11717,11029,10250,9375,8395,7305,6099,4771,3318,1739,0],["-",15496,15282,15040,14710,14334,13683,13269,12785,12225,11579,10839,9994,9034,7946,6718,5336,3786,2054,0],["-",14880,14625,14292,13868,13339,12689,11892,10930,9779,8408,6785,4870,2618,0],["-",14322,13722,12990,12104,11043,9395,6330,2648,0]]}];function un({data:t}){const s=["25 ans","20 ans","15 ans","10 ans"],a=Array.from({length:25},(n,o)=>o+1);return e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsxs("caption",{className:"text-lg font-semibold py-2",children:["Puissance Crête : ",t.puissance," kWc"]}),e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Durée"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Mensualité"}),a.map(n=>e.jsx("th",{className:"px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:n},n))]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map((n,o)=>e.jsxs("tr",{className:o%2===0?"bg-white":"bg-gray-50",children:[e.jsx("td",{className:"px-3 py-4 whitespace-nowrap text-sm text-gray-900",children:n}),e.jsxs("td",{className:"px-3 py-4 whitespace-nowrap text-sm text-gray-900",children:[t.mensualites[o].toFixed(2)," €"]}),t.remboursements[o].map((r,l)=>e.jsx("td",{className:`px-3 py-4 whitespace-nowrap text-sm text-right ${l<5?"bg-gray-100 text-gray-400":"text-gray-900"}`,children:r===0||r==="-"?"-":`${r} €`},l))]},o))})]})})}const mn=5;function xn(){return e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsx("div",{className:"bg-amber-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("p",{className:"text-sm text-amber-800",children:["Les ",mn," premières années sont grisées car elles correspondent à la période d'engagement minimum. Aucune sortie n'est possible pendant cette période"]}),e.jsxs("div",{className:"relative group",children:[e.jsx(V,{className:"h-4 w-4 text-amber-600 cursor-help flex-shrink-0"}),e.jsxs("div",{className:"absolute z-10 invisible group-hover:visible bg-gray-900 text-white text-sm rounded-lg py-2 px-3 w-80 -right-2 top-6",children:[e.jsx("div",{className:"absolute -top-1 right-3 w-2 h-2 bg-gray-900 rotate-45"}),e.jsx("p",{className:"font-medium mb-1",children:"Cas particuliers de sortie anticipée :"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"• Décès du souscripteur"}),e.jsx("li",{children:"• Divorce ou dissolution de PACS"}),e.jsx("li",{children:"• Déménagement hors zone de couverture"})]}),e.jsx("p",{className:"mt-2 text-xs text-gray-300",children:"Ces situations font l'objet d'une étude au cas par cas et peuvent permettre une sortie anticipée sans pénalités."})]})]})]})}),e.jsx("div",{className:"bg-blue-50 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-blue-800",children:"Les valeurs indiquées correspondent aux montants à verser pour sortir du contrat à la date anniversaire de l'année correspondante. Ces montants sont garantis et incluent la TVA."})})]})}function hn(){const[t,s]=m.useState(0);return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Modalités de sortie"}),e.jsx("div",{className:"flex justify-end mb-4",children:e.jsx("select",{value:t,onChange:a=>s(Number(a.target.value)),className:"rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:qe.map((a,n)=>e.jsxs("option",{value:n,children:[a.puissance," kWc"]},a.puissance))})}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx(un,{data:qe[t]})}),e.jsx(xn,{})]})}const L=class L{constructor(){X(this,"accessToken",null);X(this,"config",{clientId:"Y_LuB7HsQW3JWYudw7HRmN28FN8a",clientSecret:"Pb9H1p8zJ4IfX0xca5c7lficGo4a",redirectUri:"https://abienergie.github.io/Simulator/#/oauth/callback",authUrl:"https://mon-compte-particulier.enedis.fr/dataconnect/v1/oauth2/authorize",tokenUrl:"https://gw.hml.api.enedis.fr/oauth2/v3/token",apiUrl:"https://gw.hml.api.enedis.fr/v5/metering_data",scope:"fr_be_cons_detail_load_curve"});this.accessToken=localStorage.getItem("enedis_access_token"),console.log("Token récupéré du localStorage:",this.accessToken?"Présent":"Absent"),console.log("URL de redirection configurée:",this.config.redirectUri)}static getInstance(){return L.instance||(L.instance=new L),L.instance}async initiateAuth(){const s=new URLSearchParams({response_type:"code",client_id:this.config.clientId,duration:"P1Y",state:"AbieLink1"});return`${this.config.authUrl}?${s.toString()}`}async handleCallback(s){try{console.log("Échange du code contre un token...");const a=new URLSearchParams;a.append("grant_type","authorization_code"),a.append("client_id",this.config.clientId),a.append("client_secret",this.config.clientSecret),a.append("code",s),a.append("redirect_uri",this.config.redirectUri),console.log("Envoi de la requête au endpoint token:",this.config.tokenUrl),console.log("Paramètres:",{grant_type:"authorization_code",client_id:this.config.clientId,client_secret:"***",redirect_uri:this.config.redirectUri});const n=await fetch(this.config.tokenUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:a.toString()});if(console.log("Réponse reçue, status:",n.status),!n.ok){const l=await n.text();console.error("Erreur réponse token:",l);try{const i=JSON.parse(l);throw new Error(i.error_description||"Échec de l'échange du token")}catch{throw new Error(`Échec de l'échange du token: ${n.status} ${n.statusText}`)}}const o=await n.json();console.log("Token reçu avec succès, expires_in:",o.expires_in),localStorage.setItem("enedis_access_token",o.access_token),o.refresh_token&&localStorage.setItem("enedis_refresh_token",o.refresh_token);const r=new Date;r.setSeconds(r.getSeconds()+o.expires_in),localStorage.setItem("enedis_token_expires",r.toISOString()),this.accessToken=o.access_token,console.log("Token Enedis stocké avec succès")}catch(a){throw console.error("Erreur détaillée dans handleCallback:",a),a}}async testConnection(s){try{console.log("Test de connexion pour le PDL:",s);const a=await this.getValidToken();if(!a)return console.log("Pas de token valide disponible"),!1;const n=new Date().toISOString().split("T")[0],o=new Date;o.setDate(o.getDate()-7);const r=`${this.config.apiUrl}/daily_consumption?usage_point_id=${s}&start=${o.toISOString().split("T")[0]}&end=${n}`;console.log("URL de test:",r);const l=await fetch(r,{headers:{Authorization:`Bearer ${a}`,Accept:"application/json"}});return console.log("Réponse du test de connexion:",l.status),l.ok}catch(a){return console.error("Erreur lors du test de connexion:",a),!1}}async getConsumptionData(s,a,n){var o;try{console.log("Récupération des données de consommation pour le PDL:",s);const r=await this.getValidToken();if(!r)throw console.error("Pas de token valide disponible"),new Error("Non authentifié");if(console.log("Récupération des données de consommation réelles..."),!a){const x=new Date;x.setFullYear(x.getFullYear()-1),a=x.toISOString().split("T")[0]}if(!n){const x=new Date;x.setDate(x.getDate()+1),n=x.toISOString().split("T")[0]}console.log(`PDL: ${s}, Période: ${a} à ${n}`);const l=`${this.config.apiUrl}/daily_consumption?usage_point_id=${s}&start=${a}&end=${n}`;console.log("URL de récupération des données:",l),console.log("Envoi de la requête avec token:",r.substring(0,10)+"...");const i="",c=i?`${i}${encodeURIComponent(l)}`:l,d=await fetch(c,{method:"GET",headers:{Authorization:`Bearer ${r}`,Accept:"application/json"}});if(console.log("Réponse reçue, status:",d.status),!d.ok){const x=await d.text();if(console.error("Erreur API:",d.status,x),d.status===401){console.log("Token expiré, tentative de rafraîchissement");const p=localStorage.getItem("enedis_refresh_token");if(p)return await this.refreshToken(p),this.getConsumptionData(s,a,n)}throw new Error(`Erreur API Enedis: ${d.status}`)}const u=await d.json();if(console.log("Données reçues:",u),localStorage.setItem("enedis_raw_response",JSON.stringify(u)),!((o=u==null?void 0:u.meter_reading)!=null&&o.interval_reading))throw console.error("Format de données invalide:",u),new Error("Format de données invalide");const g=this.formatConsumptionData(u,s);return{rawResponse:u,...g}}catch(r){throw console.error("Erreur lors de la récupération des données:",r),r}}async getValidToken(){if(this.accessToken)return console.log("Utilisation du token en mémoire"),this.accessToken;const s=localStorage.getItem("enedis_access_token"),a=localStorage.getItem("enedis_token_expires");if(!s||!a)return console.log("Pas de token dans le localStorage"),null;if(console.log("Token trouvé dans le localStorage, expiration:",a),new Date(a)<=new Date){console.log("Token expiré, tentative de rafraîchissement");const n=localStorage.getItem("enedis_refresh_token");if(n)try{return await this.refreshToken(n),localStorage.getItem("enedis_access_token")}catch(o){return console.error("Erreur refresh token:",o),null}return null}return this.accessToken=s,s}async refreshToken(s){console.log("Rafraîchissement du token...");const a=new URLSearchParams;a.append("grant_type","refresh_token"),a.append("client_id",this.config.clientId),a.append("client_secret",this.config.clientSecret),a.append("refresh_token",s);const n=await fetch(this.config.tokenUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a.toString()});if(!n.ok)throw new Error("Échec du rafraîchissement du token");const o=await n.json();localStorage.setItem("enedis_access_token",o.access_token),this.accessToken=o.access_token,o.refresh_token&&localStorage.setItem("enedis_refresh_token",o.refresh_token);const r=new Date;r.setSeconds(r.getSeconds()+o.expires_in),localStorage.setItem("enedis_token_expires",r.toISOString()),console.log("Token rafraîchi avec succès")}formatConsumptionData(s,a){var n;console.log("Formatage des données de consommation");try{if(!((n=s==null?void 0:s.meter_reading)!=null&&n.interval_reading))throw console.error("Format de données invalide:",s),new Error("Format de données invalide");const o=s.meter_reading.interval_reading;console.log(`Nombre de relevés: ${o.length}`);const r={};o.forEach(i=>{const c=i.date,d=parseFloat(i.value),u=i.measure_type;r[c]||(r[c]={peakHours:0,offPeakHours:0}),u==="HP"?r[c].peakHours+=d:u==="HC"?r[c].offPeakHours+=d:r[c].peakHours+=d});const l=Object.entries(r).map(([i,c])=>({date:i,peakHours:c.peakHours,offPeakHours:c.offPeakHours,prm:s.meter_reading.usage_point_id||a}));return console.log(`Données formatées: ${l.length} jours`),{consumption:l}}catch(o){throw console.error("Erreur lors du formatage des données:",o),o}}};X(L,"instance");let xe=L;const he=xe.getInstance(),dt="enedis_consumption_data";async function pn(t){try{console.log(`Sauvegarde de ${t.length} jours de données de consommation`);const s=ut(),a=gn(s,t);return localStorage.setItem(dt,JSON.stringify(a)),a}catch(s){throw console.error("Erreur lors de la sauvegarde des données:",s),s}}async function He(t,s,a){try{console.log(`Récupération des données pour le PDL ${t} du ${s} au ${a}`);const n=ut();return fn(n,t,s,a)}catch(n){throw console.error("Erreur lors de la récupération des données:",n),n}}function ut(){const t=localStorage.getItem(dt);if(!t)return console.log("Aucune donnée stockée dans le localStorage"),[];try{const s=JSON.parse(t);return console.log(`${s.length} jours de données trouvés dans le localStorage`),s}catch(s){return console.error("Erreur lors du parsing des données stockées:",s),[]}}function gn(t,s){console.log(`Fusion de ${t.length} jours existants avec ${s.length} nouveaux jours`);const a=new Map(t.map(o=>[`${o.prm}-${o.date}`,o]));s.forEach(o=>{a.set(`${o.prm}-${o.date}`,o)});const n=Array.from(a.values());return console.log(`Résultat de la fusion: ${n.length} jours`),n}function fn(t,s,a,n){console.log(`Filtrage des données pour le PDL ${s} du ${a} au ${n}`);const o=new Date(a),r=new Date(n),l=t.filter(i=>{const c=new Date(i.date);return i.prm===s&&c>=o&&c<=r}).sort((i,c)=>new Date(i.date).getTime()-new Date(c.date).getTime());return console.log(`${l.length} jours après filtrage`),l}function bn(){const[t,s]=m.useState(!1),[a,n]=m.useState(null),[o,r]=m.useState(null),[l,i]=m.useState(!1),[c,d]=m.useState(null);m.useEffect(()=>{(async()=>{const y=localStorage.getItem("enedis_usage_point_id"),k=localStorage.getItem("enedis_access_token");if(console.log("Vérification de la connexion Enedis:",{pdl:y?"Présent":"Absent",token:k?"Présent":"Absent"}),y&&k){i(!0);const j=new Date().toISOString().split("T")[0],N=new Date(Date.now()-365*24*60*60*1e3).toISOString().split("T")[0];try{console.log("Chargement des données depuis le localStorage");const w=await He(y,N,j);if(w&&w.length>0)console.log(`${w.length} jours de données trouvés dans le localStorage`),r(w);else{console.log("Pas de données dans le localStorage, tentative de récupération depuis Enedis");try{await g(y)}catch(b){console.error("Échec de la récupération des données Enedis:",b)}}}catch(w){console.error("Erreur lors du chargement des données:",w);try{await g(y)}catch(b){console.error("Échec de la récupération des données Enedis:",b)}}}})()},[]);const u=m.useCallback(async p=>{s(!0),n(null);try{if(console.log("Test de connexion pour le PDL:",p),!localStorage.getItem("enedis_access_token"))return console.log("Pas de token disponible"),i(!1),!1;const k=await he.testConnection(p);return console.log("Résultat du test de connexion:",k),i(k),k}catch(y){console.error("Erreur lors du test de connexion:",y);const k=y instanceof Error?y.message:"Erreur lors du test de connexion";return n(k),!1}finally{s(!1)}},[]),g=m.useCallback(async p=>{s(!0),n(null);try{console.log("Récupération des données pour le PDL:",p);const y=new Date().toISOString().split("T")[0],k=new Date(Date.now()-365*24*60*60*1e3).toISOString().split("T")[0];console.log(`Récupération des données pour le PDL ${p} du ${k} au ${y}`);const j=await he.getConsumptionData(p,k,y);if(j.rawResponse&&(d(j.rawResponse),localStorage.setItem("enedis_raw_response",JSON.stringify(j.rawResponse))),!j||!j.consumption||j.consumption.length===0)throw console.log("Aucune donnée de consommation disponible"),new Error("Aucune donnée de consommation disponible");console.log(`${j.consumption.length} jours de données reçus`),await pn(j.consumption);const N=await He(p,k,y);return console.log(`${N.length} jours de données sauvegardés dans le localStorage`),r(N),{consumption:N,rawResponse:j.rawResponse}}catch(y){console.error("Erreur lors de la récupération des données:",y);const k=y instanceof Error?y.message:"Erreur lors de la récupération des données";throw n(k),y}finally{s(!1)}},[]),x=m.useCallback(()=>{console.log("Réinitialisation des données Enedis"),localStorage.removeItem("enedis_consumption_data"),localStorage.removeItem("enedis_usage_point_id"),localStorage.removeItem("enedis_access_token"),localStorage.removeItem("enedis_refresh_token"),localStorage.removeItem("enedis_token_expires"),localStorage.removeItem("enedis_raw_response"),r(null),d(null),i(!1),n(null)},[]);return{isLoading:t,error:a,consumptionData:o,rawApiResponse:c,isConnected:l,testConnection:u,fetchConsumptionData:g,resetData:x}}const q={peakHours:.2062,offPeakHours:.1547},yn=({data:t,onReset:s})=>{var C;const{clientInfo:a}=_(),n=t.reduce((h,P)=>{const E=new Date(P.date),S=`${E.getFullYear()}-${String(E.getMonth()+1).padStart(2,"0")}`;return h[S]||(h[S]={date:S,peakHours:0,offPeakHours:0,peakCost:0,offPeakCost:0}),h[S].peakHours+=P.peakHours,h[S].offPeakHours+=P.offPeakHours,h[S].peakCost+=P.peakHours*q.peakHours,h[S].offPeakCost+=P.offPeakHours*q.offPeakHours,h},{}),o=Object.values(n).map(h=>({...h,date:new Date(h.date+"-01").toLocaleDateString("fr-FR",{month:"short",year:"numeric"})})),r=o.reduce((h,P)=>h+P.peakHours,0),l=o.reduce((h,P)=>h+P.offPeakHours,0),i=r+l,c=r*q.peakHours,d=l*q.offPeakHours,u=c+d,g=t.length,x=i/g,p=r/g,y=l/g,k=t.map(h=>({date:h.date,total:h.peakHours+h.offPeakHours})),j=Math.max(...k.map(h=>h.total)),N=(C=k.find(h=>h.total===j))==null?void 0:C.date,w=N?new Date(N).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"}):"",b=r/i*100,f=l/i*100;return t.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 text-center",children:[e.jsx("p",{className:"text-gray-600",children:"Aucune donnée de consommation disponible."}),e.jsxs("button",{onClick:s,className:"mt-4 inline-flex items-center gap-2 px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors",children:[e.jsx(ne,{className:"h-4 w-4"}),"Réinitialiser"]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Analyse de consommation"}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(ms,{className:"h-5 w-5"}),e.jsxs("span",{children:["Point de livraison de ",a.civilite," ",a.nom," ",a.prenom]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Consommation totale"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-700",children:[Math.round(i).toLocaleString()," kWh"]}),e.jsxs("div",{className:"mt-1 text-sm",children:[e.jsxs("p",{className:"text-blue-600",children:["HP: ",Math.round(r).toLocaleString()," kWh"]}),e.jsxs("p",{className:"text-blue-600",children:["HC: ",Math.round(l).toLocaleString()," kWh"]})]})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-600 font-medium",children:"Dépenses totales"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700",children:[Math.round(u).toLocaleString()," €"]}),e.jsxs("p",{className:"mt-1 text-sm text-green-600",children:[(u/o.length).toFixed(2)," €/mois"]})]}),e.jsxs("div",{className:"bg-indigo-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-indigo-600 font-medium",children:"Prix heures pleines"}),e.jsxs("p",{className:"text-2xl font-bold text-indigo-700",children:[(q.peakHours*100).toFixed(2)," c€/kWh"]}),e.jsx("p",{className:"mt-1 text-sm text-indigo-600",children:"6h-22h en semaine"})]}),e.jsxs("div",{className:"bg-teal-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-teal-600 font-medium",children:"Prix heures creuses"}),e.jsxs("p",{className:"text-2xl font-bold text-teal-700",children:[(q.offPeakHours*100).toFixed(2)," c€/kWh"]}),e.jsx("p",{className:"mt-1 text-sm text-teal-600",children:"22h-6h + week-ends"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-purple-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ne,{className:"h-5 w-5 text-purple-500"}),e.jsx("h3",{className:"font-medium text-purple-900",children:"Moyennes journalières"})]}),e.jsxs("p",{className:"text-2xl font-bold text-purple-700",children:[x.toFixed(1)," kWh/jour"]}),e.jsxs("div",{className:"mt-2 text-sm space-y-1",children:[e.jsxs("p",{className:"text-purple-600",children:["HP: ",p.toFixed(1)," kWh/jour"]}),e.jsxs("p",{className:"text-purple-600",children:["HC: ",y.toFixed(1)," kWh/jour"]})]})]}),e.jsxs("div",{className:"bg-amber-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(we,{className:"h-5 w-5 text-amber-500"}),e.jsx("h3",{className:"font-medium text-amber-900",children:"Pic de consommation"})]}),e.jsxs("p",{className:"text-2xl font-bold text-amber-700",children:[j.toFixed(1)," kWh"]}),e.jsxs("p",{className:"mt-2 text-sm text-amber-600",children:["Atteint le ",w]})]}),e.jsxs("div",{className:"bg-rose-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ye,{className:"h-5 w-5 text-rose-500"}),e.jsx("h3",{className:"font-medium text-rose-900",children:"Répartition HP/HC"})]}),e.jsxs("div",{className:"relative pt-1",children:[e.jsxs("div",{className:"flex mb-2 items-center justify-between",children:[e.jsx("div",{children:e.jsx("span",{className:"text-xs font-semibold inline-block text-rose-600",children:"Heures pleines"})}),e.jsx("div",{children:e.jsxs("span",{className:"text-xs font-semibold inline-block text-rose-600",children:[b.toFixed(1),"%"]})})]}),e.jsx("div",{className:"overflow-hidden h-2 text-xs flex rounded bg-rose-200",children:e.jsx("div",{style:{width:`${b}%`},className:"shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-rose-500"})}),e.jsxs("div",{className:"flex mt-2 items-center justify-between",children:[e.jsx("div",{children:e.jsx("span",{className:"text-xs font-semibold inline-block text-rose-600",children:"Heures creuses"})}),e.jsx("div",{children:e.jsxs("span",{className:"text-xs font-semibold inline-block text-rose-600",children:[f.toFixed(1),"%"]})})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Consommation électrique mensuelle (kWh)"}),e.jsx("div",{className:"h-[400px] w-full",children:e.jsx(Ce,{width:"100%",height:"100%",children:e.jsxs(Pe,{data:o,margin:{top:5,right:30,left:20,bottom:20},barSize:20,barGap:0,children:[e.jsx(Ae,{strokeDasharray:"3 3",stroke:"#E5E7EB"}),e.jsx(Ee,{dataKey:"date",angle:-45,textAnchor:"end",height:60,tick:{fontSize:12}}),e.jsx(Me,{unit:" kWh",tick:{fontSize:12},width:80}),e.jsx(Ie,{formatter:(h,P)=>[`${Math.round(h)} kWh`,P==="peakHours"?"Heures pleines":"Heures creuses"],contentStyle:{backgroundColor:"white",border:"1px solid #E5E7EB",borderRadius:"0.375rem",padding:"8px 12px"},cursor:{fill:"rgba(229, 231, 235, 0.2)"}}),e.jsx(Re,{verticalAlign:"top",height:36,formatter:h=>h==="peakHours"?"Heures pleines":"Heures creuses"}),e.jsx(Q,{dataKey:"peakHours",name:"peakHours",stackId:"consumption",fill:"#4F46E5",radius:[4,4,0,0]}),e.jsx(Q,{dataKey:"offPeakHours",name:"offPeakHours",stackId:"consumption",fill:"#14B8A6",radius:[4,4,0,0]})]})})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Dépenses mensuelles (€)"}),e.jsx("div",{className:"h-[400px] w-full",children:e.jsx(Ce,{width:"100%",height:"100%",children:e.jsxs(Pe,{data:o,margin:{top:5,right:30,left:20,bottom:20},barSize:20,barGap:0,children:[e.jsx(Ae,{strokeDasharray:"3 3",stroke:"#E5E7EB"}),e.jsx(Ee,{dataKey:"date",angle:-45,textAnchor:"end",height:60,tick:{fontSize:12}}),e.jsx(Me,{unit:" €",tick:{fontSize:12},width:80}),e.jsx(Ie,{formatter:(h,P)=>[`${h.toFixed(2)} €`,P==="peakCost"?"Coût heures pleines":"Coût heures creuses"],contentStyle:{backgroundColor:"white",border:"1px solid #E5E7EB",borderRadius:"0.375rem",padding:"8px 12px"},cursor:{fill:"rgba(229, 231, 235, 0.2)"}}),e.jsx(Re,{verticalAlign:"top",height:36,formatter:h=>h==="peakCost"?"Coût heures pleines":"Coût heures creuses"}),e.jsx(Q,{dataKey:"peakCost",name:"peakCost",stackId:"cost",fill:"#8B5CF6",radius:[4,4,0,0]}),e.jsx(Q,{dataKey:"offPeakCost",name:"offPeakCost",stackId:"cost",fill:"#EC4899",radius:[4,4,0,0]})]})})})]}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:s,className:"inline-flex items-center gap-2 px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors",children:[e.jsx(ne,{className:"h-4 w-4"}),"Réinitialiser les données"]})})]})},jn=()=>{const[t,s]=m.useState(!1),[a,n]=m.useState(null),[o,r]=m.useState(null),[l,i]=m.useState(null),[c,d]=m.useState(null),u=W(),{consumptionData:g,isConnected:x,fetchConsumptionData:p,resetData:y}=bn();m.useEffect(()=>{if(u.state)if(u.state.success)if(r(u.state.message||"Connexion réussie"),u.state.pdl)console.log("PDL reçu dans les paramètres d'URL:",u.state.pdl),p(u.state.pdl).catch(b=>{console.error("Erreur lors de la récupération des données:",b),n(b instanceof Error?b.message:"Erreur lors de la récupération des données")});else{const b=localStorage.getItem("enedis_usage_point_id");b?(console.log("Utilisation du PDL stocké:",b),p(b).catch(f=>{console.error("Erreur lors de la récupération des données:",f),n(f instanceof Error?f.message:"Erreur lors de la récupération des données")})):(console.log("Aucun PDL disponible"),n("Aucun point de livraison (PDL) disponible"))}else u.state.error&&n(u.state.error)},[u,p]);const k=()=>{s(!0),n(null);try{window.open("https://mon-compte-particulier.enedis.fr/dataconnect/v1/oauth2/authorize?client_id=Y_LuB7HsQW3JWYudw7HRmN28FN8a&duration=P1Y&response_type=code&state=AbieLink1","_blank"),r("Redirection vers Enedis...")}catch(b){n("Erreur lors de la redirection"),console.error("Erreur:",b)}finally{s(!1)}},j=async()=>{s(!0),n(null),i(null);try{const b=localStorage.getItem("enedis_usage_point_id");if(!b)throw new Error("Aucun PDL disponible. Veuillez d'abord vous connecter à Enedis.");const f=await p(b);i(JSON.stringify(f,null,2)),r("Données récupérées avec succès")}catch(b){n(b instanceof Error?b.message:"Erreur lors de la récupération des données")}finally{s(!1)}},N=async()=>{s(!0),n(null),d(null);try{const b=localStorage.getItem("enedis_usage_point_id");if(!b)throw new Error("Aucun PDL disponible. Veuillez d'abord vous connecter à Enedis.");const f=localStorage.getItem("enedis_access_token");if(!f)throw new Error("Aucun token disponible. Veuillez d'abord vous connecter à Enedis.");const C=new Date().toISOString().split("T")[0],h=new Date(Date.now()-30*24*60*60*1e3).toISOString().split("T")[0],P=`https://gw.hml.api.enedis.fr/v5/metering_data/daily_consumption?usage_point_id=${b}&start=${h}&end=${C}`;console.log("Tentative de récupération des données brutes:",P);const E=await fetch(P,{method:"GET",headers:{Authorization:`Bearer ${f}`,Accept:"application/json"}});if(!E.ok){const M=await E.text();throw new Error(`Erreur API (${E.status}): ${M}`)}const S=await E.json();d(JSON.stringify(S,null,2)),r("Réponse brute récupérée avec succès")}catch(b){n(b instanceof Error?b.message:"Erreur lors de la récupération des données brutes")}finally{s(!1)}},w=()=>{if(!l)return;const b=new Blob([l],{type:"application/json"}),f=URL.createObjectURL(b),C=document.createElement("a");C.href=f,C.download="enedis-data.json",document.body.appendChild(C),C.click(),document.body.removeChild(C),URL.revokeObjectURL(f)};return m.useEffect(()=>{const b=localStorage.getItem("enedis_raw_response");if(b)try{JSON.parse(b),i(b)}catch(f){console.error("Données brutes stockées invalides:",f)}},[]),e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-blue-800 rounded-lg shadow-lg p-6 mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3 text-white mb-4",children:[e.jsx(je,{className:"h-8 w-8"}),e.jsx("h1",{className:"text-2xl font-bold",children:"Abie Link"})]}),e.jsx("p",{className:"text-blue-100",children:"Connectez votre compteur Linky pour suivre votre consommation d'énergie en temps réel et optimiser votre installation solaire."})]}),a&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6 flex items-start gap-3",children:[e.jsx(pe,{className:"h-5 w-5 text-red-500 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-red-700",children:a})]}),o&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-green-700",children:o})}),g?e.jsxs("div",{className:"space-y-6",children:[e.jsx(yn,{data:g,onReset:y}),e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsx("button",{onClick:j,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",disabled:t,children:t?"Chargement...":"Récupérer vos données"}),e.jsxs("button",{onClick:N,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors",disabled:t,children:[e.jsx(Ut,{className:"h-4 w-4 inline mr-2"}),t?"Chargement...":"Données brutes API"]}),e.jsx("button",{onClick:y,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors",children:"Réinitialiser"})]}),l&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Données brutes"}),e.jsxs("button",{onClick:w,className:"flex items-center gap-1 text-blue-600 hover:text-blue-800",children:[e.jsx(Gt,{className:"h-4 w-4"}),"Télécharger"]})]}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200 overflow-auto max-h-96",children:e.jsx("pre",{className:"text-xs text-gray-800 whitespace-pre-wrap",children:l})})]}),c&&e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"flex justify-between items-center mb-2",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Réponse API brute"})}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200 overflow-auto max-h-96",children:e.jsx("pre",{className:"text-xs text-gray-800 whitespace-pre-wrap",children:c})})]})]}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(tt,{className:"h-5 w-5 text-blue-500"}),e.jsx("h3",{className:"font-medium text-gray-900",children:"Suivi en temps réel"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Visualisez votre consommation d'énergie au jour le jour"})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ve,{className:"h-5 w-5 text-green-500"}),e.jsx("h3",{className:"font-medium text-gray-900",children:"Sécurisé"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Vos données sont protégées et confidentielles"})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(se,{className:"h-5 w-5 text-purple-500"}),e.jsx("h3",{className:"font-medium text-gray-900",children:"Optimisation"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Optimisez votre installation solaire selon vos besoins"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Connecter mon compteur Linky"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:"Pour connecter votre compteur Linky, cliquez sur le bouton ci-dessous. Vous serez redirigé vers le site d'Enedis où vous pourrez vous authentifier et autoriser l'accès à vos données de consommation."}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:k,disabled:t,className:"inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:[e.jsx(Jt,{className:"h-5 w-5 mr-2"}),"Se connecter à Enedis"]})})]}),t&&e.jsx("div",{className:"flex justify-center mt-4",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6 text-center",children:[e.jsx("h3",{className:"text-lg font-medium text-blue-900 mb-4",children:"Pourquoi connecter votre compteur Linky ?"}),e.jsx("p",{className:"text-blue-800 mb-4",children:"En connectant votre compteur Linky, vous pourrez visualiser votre consommation d'énergie en détail et optimiser votre installation solaire en fonction de vos habitudes de consommation."}),e.jsx("p",{className:"text-sm text-blue-700",children:"Vos données sont sécurisées et ne sont utilisées que pour vous fournir des recommandations personnalisées."})]})]})]})};function vn(){const t=U(),s=W(),[a,n]=m.useState("loading"),[o,r]=m.useState("Connexion à Enedis en cours...");return m.useEffect(()=>{(async()=>{try{console.log("Traitement du callback Enedis..."),console.log("URL complète:",window.location.href);const i=new URLSearchParams(s.search),c=s.hash;let d=i.get("code"),u=i.get("error"),g=i.get("state"),x=i.get("usage_point_id");if(c&&c.includes("?")){const p=new URLSearchParams(c.split("?")[1]);d=d||p.get("code"),u=u||p.get("error"),g=g||p.get("state"),x=x||p.get("usage_point_id")}if(console.log("Paramètres extraits:",{code:d?"***"+(d.length>6?d.slice(-6):d):null,error:u,state:g,usagePointId:x}),u){console.error("Erreur reçue:",u),n("error"),r(u),setTimeout(()=>{t("/abie-link",{state:{error:u},replace:!0})},3e3);return}if(d){r("Échange du code contre un token...");try{await he.handleCallback(d),console.log("Échange du code réussi"),x&&(console.log("Sauvegarde du PDL:",x),localStorage.setItem("enedis_usage_point_id",x)),n("success"),r("Connexion réussie, redirection..."),setTimeout(()=>{t("/abie-link",{state:{success:!0,pdl:x,message:"Connexion à Enedis réussie"},replace:!0})},2e3)}catch(p){console.error("Erreur lors de l'échange du code:",p),n("error"),r(p instanceof Error?p.message:"Erreur lors de l'échange du code"),setTimeout(()=>{t("/abie-link",{state:{error:p instanceof Error?p.message:"Échec de la connexion à Enedis"},replace:!0})},3e3)}return}n("error"),r("Aucun paramètre d'authentification reçu"),setTimeout(()=>{t("/abie-link",{state:{error:"Aucun paramètre d'authentification reçu"},replace:!0})},3e3)}catch(i){console.error("Erreur détaillée lors de la connexion Enedis:",i),n("error"),r(i instanceof Error?i.message:"Erreur inconnue"),setTimeout(()=>{t("/abie-link",{state:{error:i instanceof Error?i.message:"Échec de la connexion à Enedis"},replace:!0})},3e3)}})()},[t,s]),e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg text-center max-w-md w-full",children:[a==="loading"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-blue-500 border-t-transparent mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mb-2",children:o}),e.jsx("p",{className:"text-sm text-gray-500",children:"Veuillez patienter pendant que nous traitons votre demande"})]}),a==="success"&&e.jsxs(e.Fragment,{children:[e.jsx($t,{className:"h-12 w-12 text-green-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mb-2",children:o}),e.jsx("p",{className:"text-sm text-gray-500",children:"Vous allez être redirigé automatiquement"})]}),a==="error"&&e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mb-2",children:"Erreur de connexion"}),e.jsx("p",{className:"text-sm text-red-500 mb-4",children:o}),e.jsx("button",{onClick:()=>t("/abie-link"),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Retour à Abie Link"})]})]})})}const Nn=[{power:2.5,commercial:300,superAgency:400},{power:3,commercial:600,superAgency:700},{power:3.5,commercial:650,superAgency:750},{power:4,commercial:700,superAgency:800},{power:4.5,commercial:800,superAgency:1e3},{power:5,commercial:900,superAgency:1100},{power:5.5,commercial:1e3,superAgency:1200},{power:6,commercial:1200,superAgency:1400},{power:6.5,commercial:1300,superAgency:1500},{power:7,commercial:1400,superAgency:1600},{power:7.5,commercial:1500,superAgency:1700},{power:8,commercial:1600,superAgency:1800},{power:8.5,commercial:1700,superAgency:1900},{power:9,commercial:1800,superAgency:2e3}],wn="151515";function kn(){const[t,s]=m.useState(!1),[a,n]=m.useState(""),[o,r]=m.useState(""),l=i=>{i.preventDefault(),a===wn?(s(!0),r("")):r("Code d'accès incorrect")};return t?e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Informations agence"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Barème applicable aux commerciaux et super régies"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-blue-50 rounded-lg",children:e.jsx(Ye,{className:"h-6 w-6 text-blue-500"})}),e.jsx("h3",{className:"font-medium text-gray-900",children:"Rémunération maximale"})]}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:"2 000 €"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Pour les super régies"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-green-50 rounded-lg",children:e.jsx(Ne,{className:"h-6 w-6 text-green-500"})}),e.jsx("h3",{className:"font-medium text-gray-900",children:"Progression moyenne"})]}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:"+100 €"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Par palier de puissance"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 bg-purple-50 rounded-lg",children:e.jsx(Ft,{className:"h-6 w-6 text-purple-500"})}),e.jsx("h3",{className:"font-medium text-gray-900",children:"Bonus super régie"})]}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:"+200 €"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"En moyenne par installation"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xs,{className:"h-5 w-5 text-gray-400"}),e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Barème détaillé"})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Puissance crête"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Commercial"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Super régie (≥10/mois)"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Nn.map((i,c)=>e.jsxs("tr",{className:c%2===0?"bg-white":"bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:[i.power.toFixed(1)," kWc"]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900",children:[i.commercial.toLocaleString("fr-FR")," €"]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900",children:[i.superAgency.toLocaleString("fr-FR")," €"]})]},i.power))})]})})]}),e.jsx("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Note :"})," Les super régies doivent réaliser un minimum de 10 installations par mois pour bénéficier du barème majoré. Les rémunérations sont versées à la mise en service de l'installation."]})})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 px-4",children:e.jsxs("div",{className:"max-w-md w-full space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto h-12 w-12 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(ve,{className:"h-6 w-6 text-blue-600"})}),e.jsx("h2",{className:"mt-6 text-3xl font-bold text-gray-900",children:"Accès restreint"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Veuillez saisir le code d'accès pour consulter les informations agence"})]}),e.jsxs("form",{className:"mt-8 space-y-6",onSubmit:l,children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"accessCode",className:"sr-only",children:"Code d'accès"}),e.jsx("input",{id:"accessCode",type:"password",value:a,onChange:i=>n(i.target.value),className:"appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm",placeholder:"Code d'accès",required:!0})]}),o&&e.jsx("div",{className:"rounded-md bg-red-50 p-4",children:e.jsx("p",{className:"text-sm text-red-700",children:o})}),e.jsx("button",{type:"submit",className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Accéder"})]})]})})}function Sn(){const{settings:t,updateSettings:s,addInstallationPrice:a,removeInstallationPrice:n}=re(),[o,r]=m.useState(t),[l,i]=m.useState(!1),[c,d]=m.useState(""),[u,g]=m.useState(""),[x,p]=m.useState(null),[y,k]=m.useState(!1),[j,N]=m.useState({financial:!0,subsidies:!1,prices:!1,proPrices:!1}),w=S=>M=>{const R=parseFloat(M.target.value);isNaN(R)||r(D=>({...D,[S]:R}))},b=S=>{r(M=>({...M,sellPriceDate:S.target.value}))},f=S=>{r(M=>({...M,subsidyDate:S.target.value}))},C=S=>M=>{const R=parseFloat(M.target.value);if(!isNaN(R)){const D=[...o.installationPrices];D[S]={...D[S],price:R},r(F=>({...F,installationPrices:D}))}},h=()=>{const S=parseFloat(c),M=parseFloat(u);if(isNaN(S)||isNaN(M)||S<=0||M<=0){p("Veuillez entrer des valeurs valides");return}if(S<=9){p("La puissance doit être supérieure à 9 kWc");return}a(S,M),d(""),g(""),p(null),k(!0),setTimeout(()=>k(!1),3e3)},P=()=>{s(o),i(!0),setTimeout(()=>i(!1),3e3)},E=S=>{N(M=>({...M,[S]:!M[S]}))};return e.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-8 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Réglages"}),e.jsxs("button",{onClick:P,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(is,{className:"h-4 w-4 mr-2"}),"Appliquer les modifications"]})]}),l&&e.jsx("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-md",children:e.jsx("p",{className:"text-sm text-green-600",children:"Les modifications ont été appliquées avec succès"})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsxs("button",{onClick:()=>E("financial"),className:"w-full px-6 py-4 flex items-center justify-between text-left",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Kt,{className:"h-5 w-5 text-blue-500"}),e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Paramètres financiers"})]}),j.financial?e.jsx(ee,{className:"h-5 w-5 text-gray-400"}):e.jsx(G,{className:"h-5 w-5 text-gray-400"})]}),j.financial&&e.jsxs("div",{className:"px-6 pb-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Prix du kWh par défaut"}),e.jsxs("div",{className:"relative mt-1 rounded-md shadow-sm",children:[e.jsx("input",{type:"number",value:o.baseKwhPrice,onChange:w("baseKwhPrice"),step:"0.0001",min:"0",className:"block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-blue-500 focus:ring-blue-500 sm:text-sm"}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"€/kWh"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tarif de revente par défaut"}),e.jsxs("div",{className:"relative mt-1 rounded-md shadow-sm",children:[e.jsx("input",{type:"number",value:o.baseSellPrice,onChange:w("baseSellPrice"),step:"0.0001",min:"0",className:"block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-blue-500 focus:ring-blue-500 sm:text-sm"}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"€/kWh"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date du tarif de revente"}),e.jsx("input",{type:"date",value:o.sellPriceDate,onChange:b,className:"block w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500 sm:text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Niveau d'autoconsommation par défaut"}),e.jsxs("div",{className:"relative mt-1 rounded-md shadow-sm",children:[e.jsx("input",{type:"number",value:o.defaultAutoconsumption,onChange:w("defaultAutoconsumption"),step:"1",min:"0",max:"100",className:"block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-blue-500 focus:ring-blue-500 sm:text-sm"}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"%"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Revalorisation annuelle par défaut"}),e.jsxs("div",{className:"relative mt-1 rounded-md shadow-sm",children:[e.jsx("input",{type:"number",value:o.defaultEnergyRevaluation,onChange:w("defaultEnergyRevaluation"),step:"0.1",className:"block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-blue-500 focus:ring-blue-500 sm:text-sm"}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"%"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Indexation de la revente par défaut"}),e.jsxs("div",{className:"relative mt-1 rounded-md shadow-sm",children:[e.jsx("input",{type:"number",value:o.defaultSellIndexation,onChange:w("defaultSellIndexation"),step:"0.1",className:"block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-blue-500 focus:ring-blue-500 sm:text-sm"}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"%"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Dégradation panneaux par défaut"}),e.jsxs("div",{className:"relative mt-1 rounded-md shadow-sm",children:[e.jsx("input",{type:"number",value:o.defaultPanelDegradation,onChange:w("defaultPanelDegradation"),step:"0.1",className:"block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-blue-500 focus:ring-blue-500 sm:text-sm"}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"%"})})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsxs("button",{onClick:()=>E("subsidies"),className:"w-full px-6 py-4 flex items-center justify-between text-left",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Vt,{className:"h-5 w-5 text-green-500"}),e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Primes & Subventions"})]}),j.subsidies?e.jsx(ee,{className:"h-5 w-5 text-gray-400"}):e.jsx(G,{className:"h-5 w-5 text-gray-400"})]}),j.subsidies&&e.jsxs("div",{className:"px-6 pb-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date de validité des primes"}),e.jsx("input",{type:"date",value:o.subsidyDate,onChange:f,className:"block w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500 sm:text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Prime ≤ 3 kWc"}),e.jsxs("div",{className:"relative mt-1 rounded-md shadow-sm",children:[e.jsx("input",{type:"number",value:o.defaultSubsidyUnder3kw,onChange:w("defaultSubsidyUnder3kw"),step:"1",min:"0",className:"block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-blue-500 focus:ring-blue-500 sm:text-sm"}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"€/kWc"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Prime 3-9 kWc"}),e.jsxs("div",{className:"relative mt-1 rounded-md shadow-sm",children:[e.jsx("input",{type:"number",value:o.defaultSubsidyOver3kw,onChange:w("defaultSubsidyOver3kw"),step:"1",min:"0",className:"block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-blue-500 focus:ring-blue-500 sm:text-sm"}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"€/kWc"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Prime 9-36 kWc"}),e.jsxs("div",{className:"relative mt-1 rounded-md shadow-sm",children:[e.jsx("input",{type:"number",value:o.defaultSubsidy9to36kw,onChange:w("defaultSubsidy9to36kw"),step:"1",min:"0",className:"block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-blue-500 focus:ring-blue-500 sm:text-sm"}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"€/kWc"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Prime 36-100 kWc"}),e.jsxs("div",{className:"relative mt-1 rounded-md shadow-sm",children:[e.jsx("input",{type:"number",value:o.defaultSubsidy36to100kw,onChange:w("defaultSubsidy36to100kw"),step:"1",min:"0",className:"block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-blue-500 focus:ring-blue-500 sm:text-sm"}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"€/kWc"})})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsxs("button",{onClick:()=>E("prices"),className:"w-full px-6 py-4 flex items-center justify-between text-left",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(be,{className:"h-5 w-5 text-indigo-500"}),e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Prix des installations"})]}),j.prices?e.jsx(ee,{className:"h-5 w-5 text-gray-400"}):e.jsx(G,{className:"h-5 w-5 text-gray-400"})]}),j.prices&&e.jsx("div",{className:"px-6 pb-6",children:e.jsx("div",{className:"grid grid-cols-2 gap-4",children:o.installationPrices.filter(S=>S.power<=9).map((S,M)=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[S.power," kWc"]}),e.jsxs("div",{className:"relative mt-1 rounded-md shadow-sm",children:[e.jsx("input",{type:"number",value:S.price,onChange:C(M),step:"10",min:"0",className:"block w-full rounded-md border-gray-300 pl-3 pr-12 focus:border-blue-500 focus:ring-blue-500 sm:text-sm"}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:"€"})})]})]},S.power))})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsxs("button",{onClick:()=>E("proPrices"),className:"w-full px-6 py-4 flex items-center justify-between text-left",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Lt,{className:"h-5 w-5 text-purple-500"}),e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Prix des installations pro"})]}),j.proPrices?e.jsx(ee,{className:"h-5 w-5 text-gray-400"}):e.jsx(G,{className:"h-5 w-5 text-gray-400"})]}),j.proPrices&&e.jsx("div",{className:"px-6 pb-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-2 gap-4",children:o.installationPrices.filter(S=>S.power>9).map(S=>e.jsxs("div",{className:"relative bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"font-medium",children:[S.power," kWc"]}),e.jsx("button",{onClick:()=>n(S.power),className:"text-gray-400 hover:text-red-500",children:e.jsx(us,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"text-lg font-bold text-gray-900",children:[S.price.toLocaleString()," €"]})]},S.power))}),e.jsxs("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-3",children:"Ajouter un nouveau kit"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Puissance (kWc)"}),e.jsx("input",{type:"number",value:c,onChange:S=>d(S.target.value),min:"9.5",step:"0.5",className:"block w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500 sm:text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Prix (€)"}),e.jsx("input",{type:"number",value:u,onChange:S=>g(S.target.value),min:"0",step:"100",className:"block w-full rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500 sm:text-sm"})]})]}),x&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:x}),y&&e.jsx("p",{className:"mt-2 text-sm text-green-600",children:"Kit ajouté avec succès"}),e.jsx("button",{onClick:h,className:"mt-3 w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:"Ajouter"})]})]})})]})]})]})}function ie({children:t}){const{clientInfo:s}=_();return!(s.civilite&&s.nom&&s.prenom)?e.jsx(ft,{to:"/",replace:!0}):e.jsx(e.Fragment,{children:t})}function Cn({onLogin:t}){const[s,a]=m.useState(""),[n,o]=m.useState(""),[r,l]=m.useState(!1),[i,c]=m.useState(null),[d,u]=m.useState(!1),[g,x]=m.useState(!1),p=j=>{j.preventDefault(),l(!0),c(null),s==="abi_energie@abie.fr"&&n==="Abie2024!"?setTimeout(()=>{l(!1),t()},500):(l(!1),c("Identifiants incorrects"))},y=async j=>{j.preventDefault(),l(!0),c(null);try{c("Un email de réinitialisation vous a été envoyé")}catch{c("Erreur lors de l'envoi de l'email")}finally{l(!1)}},k=j=>{j.preventDefault(),x(!g)};return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center px-4",children:e.jsxs("div",{className:"max-w-md w-full space-y-8 bg-white p-8 rounded-lg shadow-lg",children:[e.jsxs("div",{children:[e.jsx("img",{src:"https://i.ibb.co/qLHXqbw/Logo-ABI.jpg",alt:"ABI Énergie",className:"h-32 mx-auto"}),e.jsx("h2",{className:"mt-6 text-center text-3xl font-bold text-gray-900",children:"Simulateur Solaire"}),e.jsx("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Pour accéder au simulateur, veuillez vous connecter"})]}),e.jsxs("form",{className:"mt-8 space-y-6",onSubmit:d?y:p,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"sr-only",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center",children:e.jsx(Qe,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{id:"email",name:"email",type:"email",required:!0,value:s,onChange:j=>a(j.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"Email"})]})]}),!d&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"sr-only",children:"Mot de passe"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center",children:e.jsx(ve,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{id:"password",name:"password",type:g?"text":"password",required:!0,value:n,onChange:j=>o(j.target.value),className:"block w-full pl-10 pr-10 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"Mot de passe"}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center",children:e.jsx("button",{type:"button",onClick:k,className:"p-2 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-md",children:g?e.jsx(Yt,{className:"h-5 w-5 text-gray-400 hover:text-gray-600"}):e.jsx(Zt,{className:"h-5 w-5 text-gray-400 hover:text-gray-600"})})})]})]})]}),i&&e.jsx("div",{className:"rounded-md bg-red-50 p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(pe,{className:"h-5 w-5 text-red-400"})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-red-700",children:i})})]})}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:r,className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:r?"Chargement...":d?"Envoyer le lien":"Se connecter"})}),e.jsx("div",{className:"text-sm text-center",children:e.jsx("button",{type:"button",onClick:()=>u(!d),className:"font-medium text-blue-600 hover:text-blue-500",children:d?"Retour à la connexion":"Mot de passe oublié ?"})})]}),e.jsxs("div",{className:"mt-6 text-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white text-gray-500",children:"Vous souhaitez faire une simulation ?"})})]}),e.jsx("p",{className:"mt-4 text-sm text-gray-600",children:"Rapprochez-vous d'un conseiller ABI Énergie"}),e.jsx("p",{className:"mt-2 text-sm",children:e.jsx("a",{href:"tel:0183835150",className:"font-medium text-blue-600 hover:text-blue-800",children:"01 83 83 51 50"})}),e.jsx("p",{className:"mt-2 text-sm",children:e.jsx("a",{href:"mailto:contact@abie.fr",className:"font-medium text-blue-600 hover:text-blue-800",children:"contact@abie.fr"})})]})]})})}function Pn(){const[t,s]=m.useState(!1),a=()=>{s(!0)};return t?e.jsx(bt,{children:e.jsx(It,{children:e.jsx(Rt,{children:e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(bs,{}),e.jsx(fs,{children:e.jsxs(yt,{children:[e.jsx(T,{path:"/",element:e.jsx(Ws,{})}),e.jsx(T,{path:"/projection",element:e.jsx(ie,{children:e.jsx(nn,{})})}),e.jsx(T,{path:"/eligibilite",element:e.jsx(ie,{children:e.jsx(an,{})})}),e.jsx(T,{path:"/rapport",element:e.jsx(ie,{children:e.jsx(ln,{})})}),e.jsx(T,{path:"/modalites-abonnement",element:e.jsx(dn,{})}),e.jsx(T,{path:"/modalites-sortie",element:e.jsx(hn,{})}),e.jsx(T,{path:"/abie-link",element:e.jsx(jn,{})}),e.jsx(T,{path:"/oauth/callback",element:e.jsx(vn,{})}),e.jsx(T,{path:"/agence",element:e.jsx(kn,{})}),e.jsx(T,{path:"/settings",element:e.jsx(Sn,{})})]})})]})})})}):e.jsx(Cn,{onLogin:a})}const mt=document.getElementById("root");if(!mt)throw new Error("Failed to find root element");Ue(mt).render(e.jsx(jt.StrictMode,{children:e.jsx(Pn,{})}));
